const Oe="modulepreload",Ne=function(e){return"/"+e},ye={},D=function(t,n,r){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),a=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));o=Promise.allSettled(n.map(s=>{if(s=Ne(s),s in ye)return;ye[s]=!0;const i=s.endsWith(".css"),u=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${u}`))return;const d=document.createElement("link");if(d.rel=i?"stylesheet":Oe,i||(d.as="script"),d.crossOrigin="",d.href=s,a&&d.setAttribute("nonce",a),document.head.appendChild(d),i)return new Promise((p,m)=>{d.addEventListener("load",p),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${s}`)))})}))}function l(c){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=c,window.dispatchEvent(a),!a.defaultPrevented)throw c}return o.then(c=>{for(const a of c||[])a.status==="rejected"&&l(a.reason);return t().catch(l)})};let z=[],he=!1,ee=null;async function Q(){if(he)return z;try{const e=await fetch("/api/search-index.json");if(!e.ok)throw new Error(`Erreur réseau: ${e.statusText}`);return z=await e.json(),he=!0,z}catch(e){return console.error("[FilterSort] Impossible de charger l'index des produits:",e),[]}}function He(e,t){const n=[...e];switch(t){case"price-asc":n.sort((r,o)=>r.price.amount-o.price.amount);break;case"price-desc":n.sort((r,o)=>o.price.amount-r.price.amount);break;case"name-asc":n.sort((r,o)=>r.title.localeCompare(o.title));break;case"name-desc":n.sort((r,o)=>o.title.localeCompare(r.title));break}return n}function Fe(e){const t=document.getElementById("product-grid");if(t){if(!ee){const n=t.querySelector(".product-card");if(!n)return;ee=n.cloneNode(!0)}if(t.innerHTML="",e.length===0){t.innerHTML='<p class="col-span-full text-center text-gray-500 py-8">Aucun produit ne correspond à votre sélection.</p>';return}e.forEach(n=>{const r=ee.cloneNode(!0),o=r.querySelector("a"),l=r.querySelector("img"),c=r.querySelector("h4"),a=r.querySelector(".product-price");o&&(o.href=n.url),l&&(l.src=n.coverImage,l.alt=n.title),c&&(c.textContent=n.title),a&&n.price&&(a.textContent=`${n.price.amount.toFixed(2)} ${n.price.currency}`),t.appendChild(r)})}}async function ze(){if(!document.getElementById("product-controls"))return;await Q();const t=JSON.parse(document.getElementById("zflex-data").textContent),n=t.category?t.category.id:null;if(!n)return;const r=z.filter(i=>i.categoryId===n),o=document.getElementById("sort-dropdown");if(!o)return;const l=document.getElementById("sort-btn"),c=document.getElementById("sort-label"),a=document.getElementById("sort-options"),s=a.querySelectorAll(".sort-option");l.addEventListener("click",i=>{i.stopPropagation(),a.classList.toggle("hidden")}),s.forEach(i=>{i.addEventListener("click",u=>{u.preventDefault();const d=i.dataset.value,p=i.textContent;c.textContent=`Trier par : ${p}`,a.classList.add("hidden");const m=He(r,d);Fe(m)})}),document.addEventListener("click",i=>{o.contains(i.target)||a.classList.add("hidden")}),console.log("[FilterSort] Module initialisé.")}const Ve=Object.freeze(Object.defineProperty({__proto__:null,fetchProductIndex:Q,initFilterSort:ze},Symbol.toStringTag,{value:"Module"})),O=window.zflexEventBus||new EventTarget;window.zflexEventBus=O;let k,te,ae,U,V,A,j,J,R,W=null,G=null;function de(){k&&(k.classList.add("hidden"),W=null,G=null)}function Ue(e){if(typeof W=="function")try{W()}catch(t){console.error("[Dialog] Erreur dans onConfirm:",t)}de()}function je(e){if(typeof G=="function")try{G()}catch(t){console.error("[Dialog] Erreur dans onCancel:",t)}de()}function L(e,t,n={}){if(!k){alert(`${e}

${t}`),n.onConfirm&&n.onConfirm();return}j.classList.add("hidden"),J.classList.add("hidden"),R.classList.add("hidden"),n.variant==="success"?j.classList.remove("hidden"):n.variant==="error"?J.classList.remove("hidden"):R.classList.remove("hidden"),ae.textContent=e,n.messageHtml?U.innerHTML=n.messageHtml:U.textContent=t||"",V.textContent=n.confirmText||"OK",n.cancelText?(A.classList.remove("hidden"),A.textContent=n.cancelText):A.classList.add("hidden"),W=typeof n.onConfirm=="function"?n.onConfirm:null,G=typeof n.onCancel=="function"?n.onCancel:null,k.classList.remove("hidden")}function Je(){if(k=document.getElementById("zflex-dialog"),!!k){if(te=document.getElementById("dialog-overlay"),ae=document.getElementById("dialog-title"),U=document.getElementById("dialog-message"),V=document.getElementById("dialog-confirm-btn"),A=document.getElementById("dialog-cancel-btn"),j=document.getElementById("dialog-icon-success"),J=document.getElementById("dialog-icon-error"),R=document.getElementById("dialog-icon-info"),!te||!ae||!U||!V||!j||!J||!R||!A){console.error("[Dialog] Un ou plusieurs éléments internes du dialog sont manquants. Vérifie les IDs."),k=null;return}te.addEventListener("click",de),V.addEventListener("click",Ue),A.addEventListener("click",je),O.addEventListener("dialog:show",e=>{const t=e.detail||{},{title:n,message:r,variant:o}=t,l={variant:o,onConfirm:t.onConfirm,onCancel:t.onCancel,confirmText:t.confirmText,cancelText:t.cancelText,messageHtml:t.messageHtml};L(n,r,l)}),console.log("[Dialog] Module initialisé et prêt (callbacks & HTML).")}}const ke="zflex_cart";function B(){return JSON.parse(localStorage.getItem(ke))||[]}function Y(e){localStorage.setItem(ke,JSON.stringify(e)),window.dispatchEvent(new CustomEvent("cartUpdated"))}function Re(e,t=1){const n=B(),r=n.find(o=>o.id===e.id);r?r.quantity+=t:n.push({id:e.id,title:e.title,price:e.price,coverImage:e.coverImage,url:e.url,quantity:t}),Y(n)}function We(e,t){let n=B();const r=n.find(o=>o.id===e);r&&(t>0?r.quantity=t:n=n.filter(o=>o.id!==e),Y(n))}function Ge(e){const t=B().filter(n=>n.id!==e);Y(t)}function Ft(){Y([])}function we(){const e=document.getElementById("cart-count");if(!e)return;const n=B().reduce((r,o)=>r+o.quantity,0);e.textContent=n,e.style.display=n>0?"flex":"none",n>0&&(e.classList.add("updated"),setTimeout(()=>{e.classList.remove("updated")},300))}function Te(){if(!document.querySelector('[data-page-type="cart"]'))return;const t=document.getElementById("cart-items-list"),n=document.getElementById("cart-subtotal"),r=document.getElementById("cart-total"),o=document.getElementById("cart-empty-state"),l=document.getElementById("cart-content");if(!t||!n||!r||!o||!l){console.error("[Cart] Erreur critique: DOM manquant dans cart.njk.");return}const c=B(),a=document.getElementById("cart-item-template");if(!a){console.error("[Cart] Erreur critique: le template #cart-item-template est manquant.");return}if(c.length===0){o.classList.remove("hidden"),l.classList.add("hidden");return}o.classList.add("hidden"),l.classList.remove("hidden"),t.innerHTML="";let s={};c.forEach(i=>{var b,w;const u=Number(((b=i.price)==null?void 0:b.amount)||0),d=((w=i.price)==null?void 0:w.currency)||"EUR",p=Number(i.quantity||1),m=a.content.cloneNode(!0);m.querySelector('[data-template-field="image"]').src=i.coverImage||"",m.querySelector('[data-template-field="title"]').textContent=i.title||"Produit sans nom",m.querySelector('[data-template-field="url"]').href=i.url||"#",m.querySelector('[data-template-field="price"]').textContent=`${u.toFixed(2)} ${d}`;const f=m.querySelector('[data-template-field="quantity"]');f.value=p,m.querySelector('[data-template-field="total"]').textContent=`${(u*p).toFixed(2)} ${d}`,f.addEventListener("change",()=>We(i.id,parseInt(f.value,10))),m.querySelector('[data-template-field="remove-btn"]').addEventListener("click",()=>Ge(i.id)),t.appendChild(m),s[d]||(s[d]=0),s[d]+=u*p}),n.innerHTML="",r.innerHTML="",Object.entries(s).forEach(([i,u])=>{const d=`${Number(u).toFixed(2)} ${i}`;n.innerHTML+=`<div>${d}</div>`,r.innerHTML+=`<div>${d}</div>`})}function Ke(){document.querySelector('[data-page-type="cart"]')&&(console.log("[Cart] Initialisation de la page panier..."),Te())}async function Qe(){document.querySelectorAll("#add-to-cart-btn").forEach(e=>{e.dataset.listenerAttached||(e.addEventListener("click",async()=>{e.disabled=!0;try{const t=document.getElementById("zflex-data");if(!t)throw new Error("Erreur critique: Tunnel de data #zflex-data manquant.");const n=JSON.parse(t.textContent);if(!(n!=null&&n.product))throw new Error("Données du produit non trouvées dans le tunnel de data.");const o=(await Q()).find(l=>l.id===n.product.id);if(o)Re(o),O.dispatchEvent(new CustomEvent("dialog:show",{detail:{title:"Ajouté au panier !",message:`${o.title.trim()} a bien été ajouté.`,variant:"success"}}));else throw new Error("Produit introuvable dans l'index de recherche.")}catch(t){console.error("Erreur lors de l'ajout au panier:",t),O.dispatchEvent(new CustomEvent("dialog:show",{detail:{title:"Erreur",message:t.message||"Impossible d'ajouter ce produit au panier.",variant:"error"}}))}finally{e.disabled=!1}}),e.dataset.listenerAttached="true")})}function Ye(){we(),window.addEventListener("cartUpdated",()=>{we(),Te()}),console.log("[Cart] Module global initialisé.")}async function v(e,t){var o;const r=(o=fe().apiEndpoints)==null?void 0:o[e];if(!r)throw new Error(`Endpoint API pour "${e}" non trouvé. Vérifiez la configuration du builder.`);try{const l=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),c=await l.json();if(!l.ok){const a=c.error||`Erreur ${l.status}`;throw new Error(a)}return c}catch(l){throw console.error(`[API] Erreur pour "${e}":`,l),new Error("La communication avec nos services a échoué. Veuillez réessayer.")}}function _e(e,t){return v("createConv",{storeId:e,context:t})}function Xe(e,t,n,r){return v("stacy",{storeId:e,convId:t,message:n,contextDelta:r})}function ve(e,t,n){return v("continueConv",{storeId:e,convId:t,functionCallResult:n})}function zt(e,t){return v("createOrder",{...e,storeId:t})}function Vt(e,t){return v("getOrderDetails",{orderId:e,storeId:t})}function Ut(e,t,n,r,o){return v("initiatePayment",{orderId:e,storeId:t,paymentMethod:n,paymentPhone:r,transactionReference:o})}function jt(e,t){return v("getOrderStatusApi",{orderId:e,storeId:t})}function Jt(e,t){return v("getProspectInfo",{storeId:e,prospectId:t})}function Ze(e,t){return v("subscribeToNewsletter",{email:e,storeId:t})}function et(e,t){return v("trackEvent",{storeId:e,events:t})}let S=!1,g=[],M=!1,H=null,se=null;const tt=24*60*60*1e3,K=e=>`stacy_conv_${e}`,nt=new Set(["searchProducts","getCartSummary","getContextDelta","redirectToVerifyPage"]);function P(){try{const e=document.getElementById("zflex-data");return e?JSON.parse(e.textContent||"{}"):{}}catch(e){return console.error("[Stacy] Erreur de parsing des données de la page",e),{}}}async function rt(){if(H)return H;try{const e=await fetch("/api/search-index.json");if(!e.ok)throw new Error(`Réponse réseau non OK: ${e.statusText}`);return H=await e.json(),H}catch(e){return console.error("[Stacy] Impossible de charger l'index de recherche:",e),[]}}function y(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Ae(e){try{if(/^(https?:|mailto:)/i.test(String(e).trim()))return String(e).trim()}catch{}return"#"}function ue(e){let t=y(e);return t=t.replace(/```([\s\S]*?)```/g,(n,r)=>`<pre class="stacy-code"><code>${y(r)}</code></pre>`),t=t.replace(/`([^`]+)`/g,(n,r)=>`<code class="stacy-inline-code">${y(r)}</code>`),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(n,r,o)=>`<a href="${Ae(o)}" target="_blank" rel="noopener noreferrer" class="zflex-link">${y(r)}</a>`),t=t.replace(/\*\*([^*]+)\*\*/g,(n,r)=>`<strong>${y(r)}</strong>`),t=t.replace(/\*([^*]+)\*/g,(n,r)=>`<em>${y(r)}</em>`),t=t.replace(/\r?\n/g,"<br>"),t}function me(e){try{let l=function(c){const a=Array.from(c.childNodes);for(const s of a)if(s.nodeType===Node.ELEMENT_NODE){const i=s;if(o.has(i.tagName)){if(i.tagName==="A"){const u=i.getAttribute("href")||"";/^(https?:|mailto:)/i.test(u.trim())?(i.setAttribute("target","_blank"),i.setAttribute("rel","noopener noreferrer")):i.removeAttribute("href")}else{const u=Array.from(i.attributes);for(const d of u)i.removeAttribute(d.name)}l(i)}else{const u=document.createDocumentFragment();for(;i.firstChild;)u.appendChild(i.firstChild);c.replaceChild(u,i),l(c);continue}}else s.nodeType===Node.TEXT_NODE||c.removeChild(s)};const r=new DOMParser().parseFromString(`<div>${e}</div>`,"text/html").body.firstChild,o=new Set(["A","UL","OL","LI","STRONG","EM","CODE","PRE","BR","P"]);return l(r),r.innerHTML}catch(t){return console.warn("[Stacy] sanitizeHtml failed, falling back to escaped text",t),y(e)}}function I(e,t,n={rawHtml:!1}){const r=document.querySelector("[data-stacy-messages]");if(!r)return;const o=document.createElement("div");o.className="flex flex-col p-1 my-1 max-w-[85%] text-sm break-words";const l=document.createElement("div");l.className="p-2 rounded-lg";const c=document.createElement("div");c.className="text-xs mb-1 truncate";const a=typeof e=="string"?e:JSON.stringify(e??"");t==="user"?(o.style.alignSelf="flex-end",l.classList.add("bg-primary/20","self-end"),c.textContent="Vous",c.style.textAlign="right",l.textContent=a,o.appendChild(c),o.appendChild(l)):(o.style.alignSelf="flex-start",c.textContent="Stacy",c.style.color="var(--text-muted-color)",l.classList.add("self-start"),l.style.backgroundColor="var(--chat-response-bg-color)",l.style.color="var(--text-color)",n.rawHtml?l.innerHTML=me(a):l.innerHTML=ue(a),o.appendChild(c),o.appendChild(l)),r.appendChild(o),r.scrollTop=r.scrollHeight}function ot(){const e=document.querySelector("[data-stacy-messages]");if(!e)return null;const t=document.createElement("div");return t.className="p-2 my-1 rounded-lg max-w-[60%] self-start text-sm break-words stacy-typing",t.innerHTML='<div class="typing-indicator"><span></span><span></span><span></span></div>',e.appendChild(t),e.scrollTop=e.scrollHeight,t}function at(e,t={rawHtml:!1}){const n=document.querySelector("[data-stacy-messages]");if(!n)return null;const r=document.createElement("div");r.className="flex flex-col p-1 my-1 max-w-[85%] text-sm break-words model-message-wrapper";const o=document.createElement("div");o.className="text-xs mb-1 truncate",o.textContent="Stacy",o.style.color="var(--muted-text-color)";const l=document.createElement("div");l.className="p-2 rounded-lg self-start model-message-bubble";const c=e;t.rawHtml?l.innerHTML=me(c):l.innerHTML=ue(c);const a=document.createElement("div");return a.className="stacy-partial-loader",a.style.marginTop="6px",a.innerHTML='<div class="typing-indicator"><span></span><span></span><span></span></div>',a.style.display="none",r.appendChild(o),r.appendChild(l),r.appendChild(a),n.appendChild(r),n.scrollTop=n.scrollHeight,{wrapper:r,bubble:l,loader:a}}function Ee(e){!e||!e.loader||(e.loader.style.display="",e.wrapper.scrollIntoView({behavior:"smooth",block:"end"}))}function _(e){!e||!e.loader||(e.loader.style.display="none")}function C(e,t,n={rawHtml:!1}){!e||!e.bubble||(n.rawHtml?e.bubble.innerHTML=me(t):e.bubble.innerHTML=ue(t),_(e))}async function be(e,t=12e3){let n;return Promise.race([e,new Promise((r,o)=>n=setTimeout(()=>o(new Error("timeout")),t))]).finally(()=>clearTimeout(n))}async function ne(e){const t=K(e);try{const n=localStorage.getItem(t);if(n){const o=JSON.parse(n);if(Date.now()-(o.createdAt||0)<=tt)return o.convId}const r=await _e(e);if(!(r!=null&&r.convId))throw new Error("createConversation n'a pas retourné de convId");return localStorage.setItem(t,JSON.stringify({convId:r.convId,createdAt:Date.now()})),r.convId}catch(n){throw console.error("[Stacy] Erreur getOrCreateConvId",n),n}}async function st(e){try{localStorage.removeItem(K(e));const t=document.querySelector("[data-stacy-messages]");t&&(t.innerHTML=""),g=[],M=!1;const n=await _e(e);if(n!=null&&n.convId){localStorage.setItem(K(e),JSON.stringify({convId:n.convId,createdAt:Date.now()}));const r=n.greeting||"Salut ! Je suis Stacy. Comment puis-je vous aider ?";I(r,"stacy"),g.push({role:"model",parts:[{text:r}]}),M=!0}else{const r="Salut ! Je suis Stacy. Comment puis-je vous aider ?";I(r,"stacy"),g.push({role:"model",parts:[{text:r}]}),M=!0}}catch(t){console.error("[Stacy] resetConversation error",t),I("Impossible de réinitialiser la conversation.","stacy")}}function ct(){if(M)return;const n=`Salut ! Je suis Stacy, l'assistante de ${P().storeName||"la boutique"}. Comment puis-je vous aider ?`;I(n,"stacy"),g.push({role:"model",parts:[{text:n}]}),M=!0}async function it(e){e.preventDefault();const n=e.target.querySelector("[data-stacy-input]");if(!n)return;const r=n.value.trim();r&&(I(r,"user"),g.push({role:"user",parts:[{text:r}]}),n.value="",await lt(r))}async function lt(e,t=!1){var o;const n=document.querySelector("[data-stacy-input]");n&&(n.disabled=!0);const r=ot();try{const c=P().storeId;if(!c)throw new Error("storeId introuvable");const a=await ne(c),s=await Xe(c,a,e);if(r&&r.remove(),s.newConvId&&localStorage.setItem(K(c),JSON.stringify({convId:s.newConvId,createdAt:Date.now()})),s.functionCall){const u="Un instant, je vérifie ça pour vous...",d=at(u,{rawHtml:!1});if(g.push({role:"model",parts:[{text:u}]}),Ee(d),s.needsUserInput){_(d);const p=s.answer||"J'ai besoin d'une information supplémentaire.";C(d,p,{rawHtml:!1});const m=d.wrapper,f=document.createElement("input");f.type="text",f.placeholder="Entrez le numéro de commande...",f.className="stacy-inline-input";const E=document.createElement("button");E.textContent="Envoyer",E.className="stacy-inline-btn";const b=document.createElement("div");b.style.marginTop="8px",b.appendChild(f),b.appendChild(E),m.appendChild(b),f.focus(),E.addEventListener("click",async()=>{const w=f.value.trim();if(w){b.remove(),Ee(d);try{const T=P().storeId,N=await ne(T),Z=await ve(T,N,{name:s.functionCall.name,result:{orderId:w}}),ge=(Z==null?void 0:Z.answer)??"Désolé, erreur lors de la finalisation.";C(d,ge,{rawHtml:!1}),g.push({role:"model",parts:[{text:ge}]})}catch{_(d),C(d,"Erreur lors de l'envoi de l'information. Réessaie.",{rawHtml:!1})}}}),f.addEventListener("keydown",w=>{w.key==="Enter"&&E.click()});return}if(nt.has(s.functionCall.name))try{const p=await be(dt(s.functionCall),12e3),m=p.result??p,f=(m==null?void 0:m.displayHtml)??null,E=(m==null?void 0:m.displayText)??(typeof m=="string"?m:JSON.stringify(m));f?C(d,f,{rawHtml:!0}):C(d,E,{rawHtml:!1}),g.push({role:"model",parts:[{text:E}]});const w=P().storeId,X=await ne(w),T=await be(ve(w,X,{name:s.functionCall.name,result:m}),2e4),N=(T==null?void 0:T.answer)??"Désolé, erreur lors de la finalisation.";C(d,N,{rawHtml:!0}),g.push({role:"model",parts:[{text:N}]});return}catch{_(d),C(d,"Impossible d'exécuter l'action côté client.",{rawHtml:!1});return}if(s.answer){_(d),C(d,s.answer,{rawHtml:!0}),g.push({role:"model",parts:[{text:s.answer}]});return}_(d),C(d,"Action en attente...",{rawHtml:!1});return}const i=(s==null?void 0:s.answer)??"Désolé, une erreur est survenue.";I(i,"stacy",{rawHtml:!0}),g.push({role:"model",parts:[{text:i}]}),(o=s.functionResult)!=null&&o.success&&await ut(s.functionResult)}catch(l){r&&r.remove(),console.error("[Stacy] Erreur processStacyRequest",l),I("Oups, quelque chose s'est mal passé. Veuillez réessayer.","stacy")}finally{n&&(n.disabled=!1,S&&n.focus())}}async function dt(e){const t=e.name||e.functionName||e.fn,n=e.args||e.arguments||e.params||{};switch(t){case"searchProducts":{const r=String(n.keywords||n.q||""),o=await Pe(r);return{success:!!o.success,action:"searchProducts",result:o}}case"getCartSummary":{const r=await Be();return{success:!!r.success,action:"getCartSummary",result:r}}case"redirectToVerifyPage":{const r=await pt();return{success:!!r.success,action:"redirectToVerifyPage",result:r}}case"getContextDelta":return{success:!0,action:"getContextDelta",result:mt()};default:return console.warn(`[Stacy] functionCall non géré côté client: ${t}`),{success:!1,action:String(t),result:{displayText:`Action demandée inconnue côté client: ${String(t)}`,reason:"unknown"}}}}async function ut(e){const t=(e==null?void 0:e.functionName)||(e==null?void 0:e.name)||(e==null?void 0:e.toolName)||e&&e.result&&e.result.action&&"unknown",n=(e==null?void 0:e.result)??e;if(t&&(n==null?void 0:n.action)==="delegateToFrontend")switch(t){case"searchProducts":await Pe(n.keywords||"");break;case"getCartSummary":await Be();break;default:console.warn("[Stacy] legacy delegate action not handled:",t)}}async function Pe(e){const t=await rt(),n=String(e||"").toLowerCase().split(" ").filter(o=>o),r=t.filter(o=>n.every(l=>o.title.toLowerCase().includes(l)));if(r.length>0){const o=r.slice(0,3).map(c=>`<li style="margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid var(--card-border-color);">
        <a href="${Ae(c.url)}" class="zflex-link" style="font-weight: bold;">${y(c.title)}</a> - ${c.price.amount} ${c.price.currency}
        <p style="font-size: 0.85em; margin-top: 4px; color: var(--text-muted-color);">${y(c.shortDescription)}</p>
       </li>`).join("");return{success:!0,displayHtml:`<p>J'ai trouvé ${r.length} produit(s). Voici les plus pertinents :</p><ul style="list-style: none; padding: 0;">${o}</ul>`,displayText:`J'ai trouvé ${r.length} produit(s).`}}else return{success:!1,displayText:`Désolé, je n'ai trouvé aucun produit pour "${y(String(e))}".`}}async function Be(){var c,a;const e=B();if(!Array.isArray(e)||e.length===0)return{success:!1,displayText:"Votre panier est actuellement vide."};const t=e.reduce((s,i)=>s+(i.quantity||0),0),n=e.reduce((s,i)=>{var u;return s+(((u=i.price)==null?void 0:u.amount)||0)*(i.quantity||0)},0),r=((a=(c=e[0])==null?void 0:c.price)==null?void 0:a.currency)||"USD",o=e.map(s=>`<li>${s.quantity}x ${y(s.title)}</li>`).join("");return{success:!0,displayHtml:`<p>Votre panier contient ${t} article(s) pour un total de ${n.toFixed(2)} ${r}.</p><ul>${o}</ul>`,displayText:`Votre panier contient ${t} article(s).`}}function mt(){const e=document.querySelector("#app-content main");return{pageType:(e==null?void 0:e.dataset.pageType)||"unknown",pageTitle:document.title,url:window.location.href,productContext:P().product||null}}async function pt(){if(se)try{return se.navigateTo("/verify/"),ce(),{success:!0,displayText:"[Action Système] Redirection vers /verify/ effectuée."}}catch(e){return console.warn("[Stacy] Router navigation failed",e),{success:!1,displayText:"[Action Système] Routeur non disponible."}}else return{success:!1,displayText:"[Action Système] Routeur non disponible."}}function ce(){const e=document.querySelector("[data-stacy-window]"),t=document.querySelector("[data-stacy-fab-button]");if(!e||!t)return;S=!S,e.classList.toggle("is-open",S),t.setAttribute("aria-expanded",String(S));const n=t.querySelector('[data-stacy-icon="chat"]'),r=t.querySelector('[data-stacy-icon="close"]');if(n&&r&&(n.style.opacity=S?"0":"1",r.style.opacity=S?"1":"0"),S){const o=document.querySelector("[data-stacy-input]");o&&setTimeout(()=>o.focus(),50)}}function ft(){const e=document.querySelector("[data-stacy-fab-button]");e&&e.addEventListener("click",ce);const t=document.querySelector("[data-stacy-form]");if(t){t.addEventListener("submit",it);const r=t.querySelector("[data-stacy-input]");r&&r.addEventListener("keydown",o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),t.requestSubmit())})}document.addEventListener("keydown",r=>{r.key==="Escape"&&S&&ce()});const n=document.querySelector("[data-stacy-delete]");n&&n.addEventListener("click",async()=>{try{const o=P().storeId;if(!o)throw new Error("storeId introuvable");await st(o)}catch(r){console.error("[Stacy] delete conv failed",r),I("Impossible de supprimer la conversation.","stacy")}})}function gt(e){document.querySelector("[data-stacy-fab]")&&(se=e,ft(),ct(),console.log("[Stacy] Module V7.2 (Contexte & Panier Détaillé) initialisé."))}function F(){const e=document.getElementById("search-modal"),t=document.getElementById("search-input");if(!e||!t)return;!e.classList.contains("hidden")?(e.classList.add("opacity-0"),setTimeout(()=>e.classList.add("hidden"),300)):(e.classList.remove("hidden"),requestAnimationFrame(()=>e.classList.remove("opacity-0")),t.focus())}function yt(e){const t=document.getElementById("search-results");if(t){if(e.length===0){t.innerHTML='<p class="text-center p-4" style="color: var(--text-muted-color);">Aucun résultat trouvé. Veuillez consulter notre assistante Stacy pour plus de recommandations.</p>';return}t.innerHTML=e.map(n=>`
    <a href="${n.url}" class="flex items-center p-3 hover:bg-gray-100/50 transition-colors zflex-link border-b" style="border-color: var(--card-border-color);">
      <img src="${n.coverImage}" alt="${n.title}" class="w-12 h-12 object-cover rounded-md mr-4 flex-shrink-0">
      <div class="flex-grow">
        <h4 class="font-semibold" style="color: var(--text-color);">${n.title}</h4>
        <p class="text-sm font-bold" style="color: var(--primary-color);">${n.price.amount.toFixed(2)} ${n.price.currency}</p>
      </div>
    </a>
  `).join("")}}async function ht(){const e=document.getElementById("search-toggle-btn"),t=document.getElementById("search-modal"),n=document.getElementById("search-modal-overlay"),r=document.getElementById("search-input"),o=document.getElementById("search-results");if(!e||!t||!r||!n||!o)return;const l=await Q();e.addEventListener("click",F),n.addEventListener("click",F),r.addEventListener("input",()=>{const c=r.value.trim().toLowerCase();if(c.length<2){o.innerHTML='<p class="text-center p-4" style="color: var(--text-muted-color);">Tapez au moins 2 caractères pour rechercher.</p>';return}const a=l.filter(s=>s.title.toLowerCase().includes(c)).slice(0,5);yt(a)}),document.addEventListener("keydown",c=>{c.key==="Escape"&&!t.classList.contains("hidden")&&F()}),o.addEventListener("click",c=>{c.target.closest("a")&&F()})}function wt(){const e=document.getElementById("site-header");if(!e||e.dataset.variant!=="transparent")return;const t=()=>{window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled")};window.addEventListener("scroll",t,{passive:!0}),t()}function vt(){const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-menu");!e||!t||e.addEventListener("click",()=>{t.classList.toggle("hidden")})}function Et(){const e=document.getElementById("settings-toggle-btn"),t=document.getElementById("settings-menu");!e||!t||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.toggle("hidden")}),document.addEventListener("click",()=>{t.classList.add("hidden")}))}function bt(){wt(),vt(),Et(),console.log("[GlobalUI] Module initialisé.")}const De="zflex_analytics_queue_v1",Ct=1e4,St=50,xt=3,It=150;let h=[],re=!1,oe=null,Ce=0;function Lt(){try{const e=localStorage.getItem(De);e&&(h=JSON.parse(e))}catch(e){console.warn("[Analytics] Load queue failed.",e),h=[]}}function pe(){try{localStorage.setItem(De,JSON.stringify(h))}catch(e){console.warn("[Analytics] Persist queue failed.",e)}}function kt(e,t={}){var r;const n=fe()||{};return{type:e,payload:t,storeId:n.storeId||null,context:{pageType:((r=document.querySelector("main"))==null?void 0:r.dataset.pageType)||null,title:document.title,url:window.location.href},ts:new Date().toISOString(),version:n.zflex_version||null}}function x(e,t={}){if(!e)return;const n=kt(e,t);h.push(n),pe(),console.log(`[Analytics] Event Queued: ${e}`,t)}async function $e(e,t=1){if(!e||e.length===0)return{ok:!0};try{const n=e[0].storeId;return n?await et(n,e):{ok:!1,error:"Missing storeId"}}catch(n){return t<xt?(await new Promise(r=>setTimeout(r,1e3*t)),$e(e,t+1)):{ok:!1,error:String(n)}}}async function ie(){if(!(re||h.length===0)){re=!0;try{const e=h.slice(0,St),t=await $e(e);t&&t.ok&&(h.splice(0,e.length),pe())}finally{re=!1}}}function Tt(){oe&&clearInterval(oe),oe=setInterval(ie,Ct),document.addEventListener("visibilitychange",()=>document.visibilityState==="hidden"&&ie()),window.addEventListener("beforeunload",()=>{var e;if(h.length!==0)try{const t=fe(),n=(e=t.apiEndpoints)==null?void 0:e.trackEvent;navigator.sendBeacon&&n&&(navigator.sendBeacon(n,JSON.stringify({storeId:t.storeId,events:h})),h=[],pe())}catch(t){console.warn("[Analytics] Beacon failed.",t)}})}function _t(){const e={"stacy:message_sent":t=>x("send_stacy_message",{length:t.message.length}),"cart:item_added":t=>x("add_to_cart",t.item),"cart:item_removed":t=>x("remove_from_cart",t.item),"cart:cleared":()=>x("clear_cart"),"checkout:purchase_success":t=>x("purchase",t.order)};for(const[t,n]of Object.entries(e))O.addEventListener(t,r=>n(r.detail))}function At(e){const t=e.getAttribute("data-analytics-type")||"",n=e.getAttribute("data-analytics-payload");let r={};if(n)try{r=JSON.parse(n)}catch(o){console.warn("[Analytics] Échec parsing payload, attribut brut:",{payloadAttr:n,error:o})}return{type:t,payload:r}}function Pt(){document.addEventListener("click",e=>{const t=Date.now();if(t-Ce<It){e.stopImmediatePropagation();return}Ce=t;const n=e.target.closest("[data-analytics-type]");if(!n)return;const{type:r,payload:o}=At(n);r&&x(r,o)},!0)}function Bt(){Lt(),Tt(),Pt(),_t(),console.log("[Analytics] Module V3.2 (The Final Cut) initialisé.")}function le({path:e,title:t,extra:n={}}={}){x("pageview",{url:e||window.location.href,title:t||document.title,...n})}function Dt(e,t={}){x(e,t)}window.zflexAnalytics={track:Dt,trackPageview:le,flush:ie,getQueue:()=>h};const Se={isScrolling:!1,init(){this.bindEventListeners(),window.addEventListener("popstate",()=>this.handleLocationChange());try{le()}catch(e){console.warn("[Router] Le tracking de la page initiale a échoué:",e)}console.log("[Router] Initialisé en mode GATEKEEPER.")},handleLinkClick(e){if(this.isScrolling)return;const t=e.target.closest("a.zflex-link");if(!t||t.target==="_blank")return;const n=new URL(t.href);if(n.hash&&n.pathname===window.location.pathname){e.preventDefault();const r=document.querySelector(n.hash);r&&r.scrollIntoView({behavior:"smooth",block:"start"});return}n.origin===window.location.origin&&(e.preventDefault(),this.navigateTo(n.pathname))},bindEventListeners(){document.body.addEventListener("touchstart",()=>{this.isScrolling=!1},{passive:!0}),document.body.addEventListener("touchmove",()=>{this.isScrolling=!0},{passive:!0}),document.body.addEventListener("click",this.handleLinkClick.bind(this)),document.body.addEventListener("touchend",this.handleLinkClick.bind(this))},navigateTo(e){e!==window.location.pathname&&(history.pushState({path:e},"",e),this.handleLocationChange())},async handleLocationChange(){const e=window.location.pathname;console.log(`[Router] Navigation détectée vers : ${e}`);const t=e==="/"||e===""?"/content/home.html":`/content${e.replace(/\/$/,"")}.html`,n=document.getElementById("app-content"),r=document.getElementById("router-loader");if(!n){console.error("ERREUR CRITIQUE: Conteneur #app-content introuvable.");return}r&&r.classList.remove("hidden"),n.style.opacity="0.5",n.style.transition="opacity 0.3s ease-in-out";try{const o=await fetch(t);if(!o.ok){if(o.status===404){const a=await(await fetch("/content/404.html")).text();this.updatePageContent(a,"404 - Page non trouvée");return}throw new Error(`Erreur serveur: ${o.statusText}`)}const l=await o.text();this.updatePageContent(l)}catch(o){console.error("Erreur de routage critique:",o),n.innerHTML=`
        <div class="text-center py-20">
          <h1 class="text-2xl font-bold">Erreur de chargement</h1>
          <p class="text-gray-600 mt-2">${o.message}</p>
          <button onclick="window.location.reload()" class="mt-4 bg-primary text-white font-bold py-2 px-4 rounded">Recharger la page</button>
        </div>
      `}finally{r&&r.classList.add("hidden"),document.body.contains(n)&&(n.style.opacity="1"),window.scrollTo(0,0)}},updatePageContent(e,t=null){const n=document.getElementById("app-content"),r=document.getElementById("zflex-data"),c=new DOMParser().parseFromString(e,"text/html").querySelector("main");if(c&&r){const a=c.querySelector(".zflex-fragment-data");a&&(r.textContent=a.textContent,a.remove()),document.title=t||c.dataset.pageTitle||document.title,n.innerHTML="",n.appendChild(c),Me();try{le()}catch(s){console.warn("[Router] Le tracking de la nouvelle page a échoué:",s)}}else console.error("Erreur critique: <main> ou #zflex-data manquant.")}};function $t(){try{const e=document.getElementById("zflex-data");return e?JSON.parse(e.textContent||"{}"):{}}catch(e){return console.error("[Stacy] getPageData parse error",e),{}}}function qt(){const e=document.getElementById("newsletter-form"),n=$t().storeId;if(!e){console.warn("Newsletter form not found. Skipping initialization.");return}e.addEventListener("submit",async r=>{r.preventDefault();const o=e.querySelector('input[type="email"]');if(!o){console.error("Email input not found in newsletter form."),L("Erreur","Impossible de trouver le champ email.","error");return}const l=o.value.trim();if(!l){L("Attention","Veuillez entrer une adresse email valide.","warning");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)){L("Attention","Le format de l'adresse email est invalide.","warning");return}const c=e.querySelector('button[type="submit"]');c&&(c.disabled=!0,c.textContent="Envoi..."),o.disabled=!0;try{const a=await Ze(l,n);if(a&&a.success)L("Merci !",`Vous êtes maintenant inscrit avec l'adresse : ${l}`,"success"),e.reset();else{const s=(a==null?void 0:a.message)||"Une erreur est survenue lors de l'inscription. Veuillez réessayer.";L("Erreur",s,"error")}}catch(a){console.error("Newsletter subscription error:",a),L("Erreur","Une erreur inattendue est survenue. Veuillez réessayer plus tard.","error")}finally{c&&(c.disabled=!1,c.textContent="S'abonner"),o.disabled=!1}})}let q;function Mt(){const e=document.getElementById("install-app-btn");e&&(console.log("[PWA] L'application est maintenant installable."),e.disabled=!1,e.classList.remove("opacity-50","cursor-not-allowed"),e.addEventListener("click",Ot,{once:!0}))}function qe(){const e=document.getElementById("install-app-btn"),t=document.getElementById("app-installed-message");e&&t&&(e.classList.add("hidden"),t.classList.remove("hidden"))}async function Ot(){if(!q)return;q.prompt();const{outcome:e}=await q.userChoice;e==="accepted"?(console.log("[PWA] L'utilisateur a accepté l'installation."),qe()):console.log("[PWA] L'utilisateur a refusé l'installation."),q=null}function Nt(){window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone?(console.log("[PWA] Détecté comme une application installée."),qe()):window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),q=e,Mt()}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(()=>console.log("[PWA] Service Worker OK.")).catch(e=>console.error("[PWA] Service Worker KO:",e))}let xe=!1,$=null;function fe(){const e=document.getElementById("zflex-data");if(!e||!e.textContent)return console.warn("[App] Tunnel de data #zflex-data est vide ou introuvable."),{};try{return JSON.parse(e.textContent)}catch(t){return console.error("[App] Erreur de parsing du tunnel de data #zflex-data:",t),{}}}const Ie={"product-detail":async()=>{const{initProductGallery:e}=await D(async()=>{const{initProductGallery:t}=await import("../assets/product-gallery-CW4kno63.js");return{initProductGallery:t}},[]);return Qe(),e(),{destroy:()=>console.log("[App] Cleanup: product-detail")}},"category-view":async()=>{const{initFilterSort:e}=await D(async()=>{const{initFilterSort:t}=await Promise.resolve().then(()=>Ve);return{initFilterSort:t}},void 0);return e(),{destroy:()=>console.log("[App] Cleanup: category-view")}},cart:async()=>(Ke(),{destroy:()=>console.log("[App] Cleanup: cart")}),checkout:async()=>{const{initCheckout:e}=await D(async()=>{const{initCheckout:t}=await import("../assets/checkout-D8mBWSwY.js");return{initCheckout:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: checkout")}},"order-success":async()=>{const{initOrderSuccess:e}=await D(async()=>{const{initOrderSuccess:t}=await import("../assets/order-success-DaRlGU8P.js");return{initOrderSuccess:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: order-success")}},verify:async()=>{const{initVerifyPage:e}=await D(async()=>{const{initVerifyPage:t}=await import("../assets/verify-Bve0uL8W.js");return{initVerifyPage:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: verify")}},"not-found":async()=>({destroy:()=>console.log("[App] Cleanup: not-found")}),unknown:async()=>({destroy:()=>{}})};async function Me(){var r;$&&typeof $.destroy=="function"&&$.destroy();const e=document.querySelector("#app-content main"),t=((r=e==null?void 0:e.dataset)==null?void 0:r.pageType)||"unknown";console.log(`[App] Chargement des scripts pour la page: "${t}"`);const n=Ie[t]||Ie.unknown;try{$=await n()}catch(o){console.error(`[App] Erreur lors du chargement du module pour "${t}":`,o),$=null}qt()}function Ht(){console.log("[Preview] Initialisation du mode éditeur temps réel");const e={"palette.primary":"--primary-color","palette.secondary":"--secondary-color","palette.background":"--bg-color","palette.text":"--text-color","palette.accent":"--accent-color","palette.cardBackground":"--card-bg-color","palette.textMuted":"--text-muted-color","palette.cardBorder":"--card-border-color","palette.inputBackground":"--input-bg-color","palette.chatResponseBackground":"--chat-response-bg-color",primary:"--primary-color",secondary:"--secondary-color",background:"--bg-color",text:"--text-color",accent:"--accent-color",cardBackground:"--card-bg-color","primary-color":"--primary-color","bg-color":"--bg-color","card-bg-color":"--card-bg-color"};function t(a){if(!a)return null;if(typeof a=="string"&&a.startsWith("--"))return a;const s=String(a).trim();if(e[s])return e[s];const i=s.replace(/^palette[\._-]?/i,"").replace(/\./g,"").replace(/_/g,"").toLowerCase(),u={primary:"--primary-color",primary600:"--primary-600",primary700:"--primary-700",secondary:"--secondary-color",secondary600:"--secondary-600",background:"--bg-color",text:"--text-color",accent:"--accent-color",cardbackground:"--card-bg-color",textmuted:"--text-muted-color",cardborder:"--card-border-color",inputbackground:"--input-bg-color",chatresponsebackground:"--chat-response-bg-color"};return u[i]?u[i]:`--${s.replace(/^palette[\._-]?/i,"").replace(/\./g,"-").replace(/_/g,"-").toLowerCase()}`}function n(a={}){if(!a||typeof a!="object")return;const s=document.documentElement;Object.keys(a).forEach(i=>{const u=a[i];if(typeof u!="string"&&typeof u!="number")return;const d=i.startsWith("--")?i:t(i)||`--${i}`;s.style.setProperty(d,String(u))}),window.requestAnimationFrame(()=>{document.body.offsetHeight})}function r(a){if(!a)return;const s=a.computed||{},i=a.palette||{},u={};Object.keys(i).forEach(d=>{const p=t(d)||t(`palette.${d}`)||`--${d}`;u[p]=i[d]}),Object.keys(s).forEach(d=>{const p=t(d)||`--${d.replace(/[A-Z]/g,m=>"-"+m.toLowerCase())}`;u[p]=s[d]}),n(u),console.log("[Preview] Applied computed palette vars:",u)}function o(a){if(a==null)return"";let s=String(a).trim();return/^[0-9A-Fa-f]{6}$/.test(s)&&(s="#"+s),s}function l(a){if(!a)return;let{property:s,value:i}=a;const u=t(s)||s,d=o(i);u&&(document.documentElement.style.setProperty(u,d),(u.includes("color")||u.includes("bg")||u.includes("background"))&&(document.body.style.transition="background-color 0.22s ease, color 0.22s ease, border-color 0.22s ease",setTimeout(()=>{document.body.style.transition=""},300)),console.log(`[Preview] Mise à jour style (incoming: ${String(s)}) -> canonical: ${u}: ${d}`))}function c(a){if(!a)return;const{id:s,value:i}=a,u=document.querySelector(`[data-zflex-id="${s}"]`);if(!u){console.warn(`[Preview] Élément avec data-zflex-id="${s}" non trouvé`);return}u.tagName==="IMG"?(u.src=i,u.alt=i||""):u.textContent=i,u.style.transition="all 0.18s ease",u.style.transform="scale(1.01)",setTimeout(()=>{u.style.transform=""},220)}window.addEventListener("message",a=>{if(!(a!=null&&a.data))return;const s=a.data;if(s.source==="zflex-admin")switch(console.log("[Preview] Message reçu de l'éditeur:",s),s.action){case"updateElement":c(s.payload);break;case"updateStyle":l(s.payload);break;case"updatePalette":r(s.payload);break;default:console.warn("[Preview] Action non reconnue:",s.action)}}),window.parent!==window&&window.parent.postMessage({source:"zflex-preview",action:"ready",payload:{url:window.location.href}},"*")}function Le(){if(xe)return;console.log("[App] Démarrage zFlex — L'Architecture Finale.");const e=new URLSearchParams(window.location.search).get("preview")==="true";e?(console.log("[App] Mode Preview activé - Désactivation des interactions utilisateur"),document.body.style.pointerEvents="none",document.body.style.cursor="not-allowed",Ht()):console.log("[App] Mode normal - Initialisation des scripts interactifs");try{if(!window.firebase||!window.firebase.initializeApp)throw new Error("Le SDK Firebase (compat) n'a pas été chargé. Vérifie les scripts dans _head.njk.");const n=document.getElementById("firebase-config-data");if(!n)throw new Error("Firebase config data island not found.");const r=JSON.parse(n.textContent||"{}");if(!r.apiKey)throw new Error("Firebase apiKey is missing.");window.firebase.initializeApp(r),console.log("[Firebase] Initialisation via le scope global réussie.")}catch(n){console.error("[Firebase] ÉCHEC CRITIQUE DE L'INITIALISATION :",n);return}e||(Ye(),gt(Se),bt(),ht(),Je(),Nt(),Bt(),Se.init()),Me(),xe=!0;const t=["color: #00BFFF","font-size: 12px","font-family: monospace","background: #0E0E0E","padding: 4px 8px","border-radius: 4px"].join(";");console.log("%c Fearless Engine: Online. Status: Flawless. ",t),window.location.hostname==="localhost"||window.location.hostname.includes("192.168.")?(console.log("------------------"),console.log("< Happy Hacking! — Fearless >"),console.log("------------------"),console.log("        \\   ^__^"),console.log("         \\  (oo)\\_______"),console.log("            (__)\\       )/\\"),console.log("                ||----w |"),console.log("                ||     ||"),console.log(`
version: dev (local)`)):(console.log("------------------"),console.log("< Ready for Action! — Fearless >"),console.log("------------------"),console.log("        \\   ^__^"),console.log("         \\  (oo)\\_______"),console.log("            (__)\\       )/\\"),console.log("                ||----w |"),console.log("                ||     ||"),console.log(`
version: production (${new Date().toISOString().slice(0,10)})`))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Le,{once:!0}):Le();export{D as _,Jt as a,jt as b,zt as c,Ft as d,O as e,Vt as f,B as g,Ut as i,Se as r,L as s};
