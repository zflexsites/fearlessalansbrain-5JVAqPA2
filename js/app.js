const $e="modulepreload",He=function(e){return"/"+e},me={},B=function(t,n,r){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),s=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=Promise.allSettled(n.map(c=>{if(c=He(c),c in me)return;me[c]=!0;const l=c.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":$e,l||(u.as="script"),u.crossOrigin="",u.href=c,s&&u.setAttribute("nonce",s),document.head.appendChild(u),l)return new Promise((m,f)=>{u.addEventListener("load",m),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(i){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=i,window.dispatchEvent(s),!s.defaultPrevented)throw i}return o.then(i=>{for(const s of i||[])s.status==="rejected"&&a(s.reason);return t().catch(a)})};let N=[],fe=!1,X=null;async function K(){if(fe)return N;try{const e=await fetch("/api/search-index.json");if(!e.ok)throw new Error(`Erreur r√©seau: ${e.statusText}`);return N=await e.json(),fe=!0,N}catch(e){return console.error("[FilterSort] Impossible de charger l'index des produits:",e),[]}}function Ne(e,t){const n=[...e];switch(t){case"price-asc":n.sort((r,o)=>r.price.amount-o.price.amount);break;case"price-desc":n.sort((r,o)=>o.price.amount-r.price.amount);break;case"name-asc":n.sort((r,o)=>r.title.localeCompare(o.title));break;case"name-desc":n.sort((r,o)=>o.title.localeCompare(r.title));break}return n}function Re(e){const t=document.getElementById("product-grid");if(t){if(!X){const n=t.querySelector(".product-card");if(!n)return;X=n.cloneNode(!0)}if(t.innerHTML="",e.length===0){t.innerHTML='<p class="col-span-full text-center text-gray-500 py-8">Aucun produit ne correspond √† votre s√©lection.</p>';return}e.forEach(n=>{const r=X.cloneNode(!0),o=r.querySelector("a"),a=r.querySelector("img"),i=r.querySelector("h4"),s=r.querySelector(".product-price");o&&(o.href=n.url),a&&(a.src=n.coverImage,a.alt=n.title),i&&(i.textContent=n.title),s&&n.price&&(s.textContent=`${n.price.amount.toFixed(2)} ${n.price.currency}`),t.appendChild(r)})}}async function ze(){if(!document.getElementById("product-controls"))return;await K();const t=JSON.parse(document.getElementById("zflex-data").textContent),n=t.category?t.category.id:null;if(!n)return;const r=N.filter(l=>l.categoryId===n),o=document.getElementById("sort-dropdown");if(!o)return;const a=document.getElementById("sort-btn"),i=document.getElementById("sort-label"),s=document.getElementById("sort-options"),c=s.querySelectorAll(".sort-option");a.addEventListener("click",l=>{l.stopPropagation(),s.classList.toggle("hidden")}),c.forEach(l=>{l.addEventListener("click",d=>{d.preventDefault();const u=l.dataset.value,m=l.textContent;i.textContent=`Trier par : ${m}`,s.classList.add("hidden");const f=Ne(r,u);Re(f)})}),document.addEventListener("click",l=>{o.contains(l.target)||s.classList.add("hidden")}),console.log("[FilterSort] Module initialis√©.")}const Fe=Object.freeze(Object.defineProperty({__proto__:null,fetchProductIndex:K,initFilterSort:ze},Symbol.toStringTag,{value:"Module"})),q=window.zflexEventBus||new EventTarget;window.zflexEventBus=q;let S,Z,ne,z,R,T,F,V,U,j=null,J=null;function ce(){S&&(S.classList.add("hidden"),j=null,J=null)}function Ve(e){if(typeof j=="function")try{j()}catch(t){console.error("[Dialog] Erreur dans onConfirm:",t)}ce()}function Ue(e){if(typeof J=="function")try{J()}catch(t){console.error("[Dialog] Erreur dans onCancel:",t)}ce()}function C(e,t,n={}){if(!S){alert(`${e}

${t}`),n.onConfirm&&n.onConfirm();return}F.classList.add("hidden"),V.classList.add("hidden"),U.classList.add("hidden"),n.variant==="success"?F.classList.remove("hidden"):n.variant==="error"?V.classList.remove("hidden"):U.classList.remove("hidden"),ne.textContent=e,n.messageHtml?z.innerHTML=n.messageHtml:z.textContent=t||"",R.textContent=n.confirmText||"OK",n.cancelText?(T.classList.remove("hidden"),T.textContent=n.cancelText):T.classList.add("hidden"),j=typeof n.onConfirm=="function"?n.onConfirm:null,J=typeof n.onCancel=="function"?n.onCancel:null,S.classList.remove("hidden")}function je(){if(S=document.getElementById("zflex-dialog"),!!S){if(Z=document.getElementById("dialog-overlay"),ne=document.getElementById("dialog-title"),z=document.getElementById("dialog-message"),R=document.getElementById("dialog-confirm-btn"),T=document.getElementById("dialog-cancel-btn"),F=document.getElementById("dialog-icon-success"),V=document.getElementById("dialog-icon-error"),U=document.getElementById("dialog-icon-info"),!Z||!ne||!z||!R||!F||!V||!U||!T){console.error("[Dialog] Un ou plusieurs √©l√©ments internes du dialog sont manquants. V√©rifie les IDs."),S=null;return}Z.addEventListener("click",ce),R.addEventListener("click",Ve),T.addEventListener("click",Ue),q.addEventListener("dialog:show",e=>{const t=e.detail||{},{title:n,message:r,variant:o}=t,a={variant:o,onConfirm:t.onConfirm,onCancel:t.onCancel,confirmText:t.confirmText,cancelText:t.cancelText,messageHtml:t.messageHtml};C(n,r,a)}),console.log("[Dialog] Module initialis√© et pr√™t (callbacks & HTML).")}}const Se="zflex_cart";function _(){return JSON.parse(localStorage.getItem(Se))||[]}function G(e){localStorage.setItem(Se,JSON.stringify(e)),window.dispatchEvent(new CustomEvent("cartUpdated"))}function xe(e,t=1){const n=_(),r=n.find(o=>o.id===e.id);r?r.quantity+=t:n.push({id:e.id,title:e.title,price:e.price,coverImage:e.coverImage,url:e.url,quantity:t}),G(n)}function Je(e,t){let n=_();const r=n.find(o=>o.id===e);r&&(t>0?r.quantity=t:n=n.filter(o=>o.id!==e),G(n))}function Ie(e){const t=_().filter(n=>n.id!==e);G(t)}function $t(){G([])}function pe(){const e=document.getElementById("cart-count");if(!e)return;const n=_().reduce((r,o)=>r+o.quantity,0);e.textContent=n,e.style.display=n>0?"flex":"none",n>0&&(e.classList.add("updated"),setTimeout(()=>{e.classList.remove("updated")},300))}function Le(){if(!document.querySelector('[data-page-type="cart"]'))return;const t=document.getElementById("cart-items-list"),n=document.getElementById("cart-subtotal"),r=document.getElementById("cart-total"),o=document.getElementById("cart-empty-state"),a=document.getElementById("cart-content");if(!t||!n||!r||!o||!a){console.error("[Cart] Erreur critique: DOM manquant dans cart.njk.");return}const i=_(),s=document.getElementById("cart-item-template");if(!s){console.error("[Cart] Erreur critique: le template #cart-item-template est manquant.");return}if(i.length===0){o.classList.remove("hidden"),a.classList.add("hidden");return}o.classList.add("hidden"),a.classList.remove("hidden"),t.innerHTML="";let c={};i.forEach(l=>{var E,P;const d=Number(((E=l.price)==null?void 0:E.amount)||0),u=((P=l.price)==null?void 0:P.currency)||"EUR",m=Number(l.quantity||1),f=s.content.cloneNode(!0);f.querySelector('[data-template-field="image"]').src=l.coverImage||"",f.querySelector('[data-template-field="title"]').textContent=l.title||"Produit sans nom",f.querySelector('[data-template-field="url"]').href=l.url||"#",f.querySelector('[data-template-field="price"]').textContent=`${d.toFixed(2)} ${u}`;const x=f.querySelector('[data-template-field="quantity"]');x.value=m,f.querySelector('[data-template-field="total"]').textContent=`${(d*m).toFixed(2)} ${u}`,x.addEventListener("change",()=>Je(l.id,parseInt(x.value,10))),f.querySelector('[data-template-field="remove-btn"]').addEventListener("click",()=>Ie(l.id)),t.appendChild(f),c[u]||(c[u]=0),c[u]+=d*m}),n.innerHTML="",r.innerHTML="",Object.entries(c).forEach(([l,d])=>{const u=`${Number(d).toFixed(2)} ${l}`;n.innerHTML+=`<div>${u}</div>`,r.innerHTML+=`<div>${u}</div>`})}function We(){document.querySelector('[data-page-type="cart"]')&&(console.log("[Cart] Initialisation de la page panier..."),Le())}async function Ke(){document.querySelectorAll("#add-to-cart-btn").forEach(e=>{e.dataset.listenerAttached||(e.addEventListener("click",async()=>{e.disabled=!0;try{const t=document.getElementById("zflex-data");if(!t)throw new Error("Erreur critique: Tunnel de data #zflex-data manquant.");const n=JSON.parse(t.textContent);if(!(n!=null&&n.product))throw new Error("Donn√©es du produit non trouv√©es dans le tunnel de data.");const o=(await K()).find(a=>a.id===n.product.id);if(o)xe(o),q.dispatchEvent(new CustomEvent("dialog:show",{detail:{title:"Ajout√© au panier !",message:`${o.title.trim()} a bien √©t√© ajout√©.`,variant:"success"}}));else throw new Error("Produit introuvable dans l'index de recherche.")}catch(t){console.error("Erreur lors de l'ajout au panier:",t),q.dispatchEvent(new CustomEvent("dialog:show",{detail:{title:"Erreur",message:t.message||"Impossible d'ajouter ce produit au panier.",variant:"error"}}))}finally{e.disabled=!1}}),e.dataset.listenerAttached="true")})}function Ge(){pe(),window.addEventListener("cartUpdated",()=>{pe(),Le()}),console.log("[Cart] Module global initialis√©.")}async function g(e,t){var o;const r=(o=ue().apiEndpoints)==null?void 0:o[e];if(!r)throw new Error(`Endpoint API pour "${e}" non trouv√©. V√©rifiez la configuration du builder.`);try{const a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),i=await a.json();if(!a.ok){const s=i.error||`Erreur ${a.status}`;throw new Error(s)}return i}catch(a){throw console.error(`[API] Erreur pour "${e}":`,a),new Error("La communication avec nos services a √©chou√©. Veuillez r√©essayer.")}}function Te(e,t){return g("createConv",{storeId:e,context:t})}function Qe(e,t,n,r){return g("stacy",{storeId:e,convId:t,message:n,contextDelta:r})}function ge(e,t,n){return g("continueConv",{storeId:e,convId:t,functionCallResult:n})}function Ht(e,t){return g("createOrder",{...e,storeId:t})}function Nt(e,t){return g("getOrderDetails",{orderId:e,storeId:t})}function Rt(e,t,n,r,o){return g("initiatePayment",{orderId:e,storeId:t,paymentMethod:n,paymentPhone:r,transactionReference:o})}function zt(e,t){return g("getOrderStatusApi",{orderId:e,storeId:t})}function Ft(e,t){return g("getProspectInfo",{storeId:e,prospectId:t})}function Ye(e,t){return g("subscribeToNewsletter",{email:e,storeId:t})}function Xe(e,t){return g("trackEvent",{storeId:e,events:t})}let y=!1,v=[],re=null,$=null;const ke=24*60*60*1e3,k=e=>`stacy_conv_${e}`,Q=e=>`stacy_history_${e}`,Ze=new Set(["searchProducts","manageCart","getContextDelta","redirectToVerifyPage"]);function M(){try{const e=document.getElementById("zflex-data");return e?JSON.parse(e.textContent||"{}"):{}}catch(e){return console.error("[Stacy] Erreur de parsing des donn√©es de la page",e),{}}}async function _e(){if($)return $;try{const e=await fetch("/api/search-index.json");if(!e.ok)throw new Error(`R√©ponse r√©seau non OK: ${e.statusText}`);return $=await e.json(),$}catch(e){return console.error("[Stacy] Impossible de charger l'index de recherche:",e),[]}}function h(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function et(e){try{if(/^(https?:|mailto:)/i.test(String(e).trim()))return String(e).trim()}catch{}return"#"}function ie(e){let t=h(e);return t=t.replace(/```([\s\S]*?)```/g,(n,r)=>`<pre class="stacy-code"><code>${h(r)}</code></pre>`),t=t.replace(/`([^`]+)`/g,(n,r)=>`<code class="stacy-inline-code">${h(r)}</code>`),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(n,r,o)=>`<a href="${et(o)}" target="_blank" rel="noopener noreferrer" class="zflex-link">${h(r)}</a>`),t=t.replace(/\*\*([^*]+)\*\*/g,(n,r)=>`<strong>${h(r)}</strong>`),t=t.replace(/\*([^*]+)\*/g,(n,r)=>`<em>${h(r)}</em>`),t=t.replace(/\r?\n/g,"<br>"),t}function le(e){try{let a=function(i){const s=Array.from(i.childNodes);for(const c of s)if(c.nodeType===Node.ELEMENT_NODE){const l=c;if(o.has(l.tagName)){if(l.tagName==="A"){const d=l.getAttribute("href")||"";/^(https?:|mailto:)/i.test(d.trim())?(l.setAttribute("target","_blank"),l.setAttribute("rel","noopener noreferrer")):l.removeAttribute("href")}else{const d=Array.from(l.attributes);for(const u of d)l.removeAttribute(u.name)}a(l)}else{const d=document.createDocumentFragment();for(;l.firstChild;)d.appendChild(l.firstChild);i.replaceChild(d,l),a(i);continue}}else c.nodeType!==Node.TEXT_NODE&&i.removeChild(c)};const r=new DOMParser().parseFromString(`<div>${e}</div>`,"text/html").body.firstChild,o=new Set(["A","UL","OL","LI","STRONG","EM","CODE","PRE","BR","P"]);return a(r),r.innerHTML}catch(t){return console.warn("[Stacy] sanitizeHtml failed, falling back to escaped text",t),h(e)}}function Y(e,t,n={rawHtml:!1}){const r=document.querySelector("[data-stacy-messages]");if(!r)return;const o=document.createElement("div");o.className="flex flex-col p-1 my-1 max-w-[85%] text-sm break-words";const a=document.createElement("div");a.className="p-2 rounded-lg";const i=document.createElement("div");i.className="text-xs mb-1 truncate";const s=typeof e.text=="string"?e.text:JSON.stringify(e.text??"");t==="user"?(o.style.alignSelf="flex-end",a.classList.add("bg-primary/20","self-end"),i.textContent="Vous",i.style.textAlign="right",a.textContent=s):(o.style.alignSelf="flex-start",i.textContent="Stacy",i.style.color="var(--text-muted-color)",a.classList.add("self-start"),a.style.backgroundColor="var(--chat-response-bg-color)",a.style.color="var(--text-color)",n.rawHtml?a.innerHTML=le(s):a.innerHTML=ie(s)),o.appendChild(i),o.appendChild(a),r.appendChild(o),r.scrollTop=r.scrollHeight}function Ae(){const e=document.querySelector("[data-stacy-messages]");e&&(e.innerHTML="",v.forEach(t=>Y(t,t.role,{rawHtml:!0})))}async function tt(){const e=M().storeId;if(!e)return;const t=JSON.parse(localStorage.getItem(k(e))||"null");t&&Date.now()-t.createdAt<ke?(v=JSON.parse(localStorage.getItem(Q(t.convId))||"[]"),Ae()):await Be(e)}function L(e){localStorage.setItem(Q(e),JSON.stringify(v))}function W(e,t){const n={role:t,text:e,ts:Date.now()};v.push(n),Y(n,t,{rawHtml:!0})}function nt(){const e=document.querySelector("[data-stacy-messages]");if(!e)return null;const t=document.createElement("div");return t.className="p-2 my-1 rounded-lg max-w-[60%] self-start text-sm break-words stacy-typing",t.innerHTML='<div class="typing-indicator"><span></span><span></span><span></span></div>',e.appendChild(t),e.scrollTop=e.scrollHeight,t}function rt(e,t={rawHtml:!1}){const n=document.querySelector("[data-stacy-messages]");if(!n)return null;const r=document.createElement("div");r.className="flex flex-col p-1 my-1 max-w-[85%] text-sm break-words model-message-wrapper";const o=document.createElement("div");o.className="text-xs mb-1 truncate",o.textContent="Stacy",o.style.color="var(--muted-text-color)";const a=document.createElement("div");a.className="p-2 rounded-lg self-start model-message-bubble";const i=e;t.rawHtml?a.innerHTML=le(i):a.innerHTML=ie(i);const s=document.createElement("div");return s.className="stacy-partial-loader",s.style.marginTop="6px",s.innerHTML='<div class="typing-indicator"><span></span><span></span><span></span></div>',s.style.display="none",r.appendChild(o),r.appendChild(a),r.appendChild(s),n.appendChild(r),n.scrollTop=n.scrollHeight,{wrapper:r,bubble:a,loader:s}}function ye(e){!e||!e.loader||(e.loader.style.display="",e.wrapper.scrollIntoView({behavior:"smooth",block:"end"}))}function I(e){!e||!e.loader||(e.loader.style.display="none")}function b(e,t,n={rawHtml:!1}){!e||!e.bubble||(n.rawHtml?e.bubble.innerHTML=le(t):e.bubble.innerHTML=ie(t),I(e))}async function he(e,t=12e3){let n;return Promise.race([e,new Promise((r,o)=>n=setTimeout(()=>o(new Error("timeout")),t))]).finally(()=>clearTimeout(n))}async function Pe(e){const t=k(e);try{const n=localStorage.getItem(t);if(n){const o=JSON.parse(n);if(Date.now()-(o.createdAt||0)<=ke)return o.convId}const r=await Te(e);if(!(r!=null&&r.convId))throw new Error("createConversation n'a pas retourn√© de convId");return localStorage.setItem(t,JSON.stringify({convId:r.convId,createdAt:Date.now()})),localStorage.removeItem(Q(r.convId)),r.convId}catch(n){throw console.error("[Stacy] Erreur getOrCreateConvId",n),n}}async function Be(e){try{const t=JSON.parse(localStorage.getItem(k(e))||"null");t&&localStorage.removeItem(Q(t.convId)),localStorage.removeItem(k(e)),v=[],Ae();const n=await Te(e);if(n!=null&&n.convId){localStorage.setItem(k(e),JSON.stringify({convId:n.convId,createdAt:Date.now()}));const r=n.greeting||"Salut ! C'est Stacy, ton assistante shopping. Pr√™t(e) √† trouver des p√©pites ? ‚ú®";W(r,"model"),L(n.convId)}}catch(t){console.error("[Stacy] resetConversation error",t),Y({text:"Impossible de r√©initialiser la conversation."},"model")}}async function ot(e){e.preventDefault();const n=e.target.querySelector("[data-stacy-input]");if(!n)return;const r=n.value.trim();if(!r)return;W(r,"user"),n.value="";const o=M().storeId,a=await Pe(o);L(a),await at(r)}async function at(e){const t=document.querySelector("[data-stacy-input]");t&&(t.disabled=!0);const n=nt();try{const r=M().storeId;if(!r)throw new Error("storeId introuvable");const o=await Pe(r),a=await Qe(r,o,e);if(n&&n.remove(),a.newConvId&&localStorage.setItem(k(r),JSON.stringify({convId:a.newConvId,createdAt:Date.now()})),a.functionCall){const c=rt("Un instant, je r√©fl√©chis... ü§î",{rawHtml:!1});if(ye(c),a.needsUserInput){I(c);const l=a.answer||"J'ai besoin d'une information suppl√©mentaire.";b(c,l,{rawHtml:!1});const d=c.wrapper,u=document.createElement("input");u.type="text",u.placeholder="Entrez le num√©ro de commande...",u.className="stacy-inline-input";const m=document.createElement("button");m.textContent="Envoyer",m.className="stacy-inline-btn";const f=document.createElement("div");f.style.marginTop="8px",f.appendChild(u),f.appendChild(m),d.appendChild(f),u.focus();const x=async()=>{const A=u.value.trim();if(A){f.remove(),ye(c);try{const E=await ge(r,o,{name:a.functionCall.name,result:{orderId:A}}),P=(E==null?void 0:E.answer)??"D√©sol√©, erreur lors de la finalisation.";b(c,P,{rawHtml:!0}),v.push({role:"model",text:P}),L(o)}catch{I(c),b(c,"Erreur lors de l'envoi de l'information. R√©essaie.",{rawHtml:!1})}}};m.addEventListener("click",x),u.addEventListener("keydown",A=>{A.key==="Enter"&&x()});return}if(Ze.has(a.functionCall.name))try{const l=await he(st(a.functionCall),12e3),d=l.result??l,u=await he(ge(r,o,{name:a.functionCall.name,result:d}),2e4),m=(u==null?void 0:u.answer)??"D√©sol√©, erreur lors de la finalisation.";m.includes("__tool_result")?c.wrapper.remove():(b(c,m,{rawHtml:!0}),v.push({role:"model",text:m})),L(o);return}catch{I(c),b(c,"Impossible d'ex√©cuter l'action c√¥t√© client.",{rawHtml:!1});return}if(a.answer){I(c),b(c,a.answer,{rawHtml:!0}),v.push({role:"model",text:a.answer}),L(o);return}I(c),b(c,"Action en attente...",{rawHtml:!1});return}const i=(a==null?void 0:a.answer)??"D√©sol√©, une erreur est survenue.";W(i,"model"),L(o)}catch(r){n&&n.remove(),console.error("[Stacy] Erreur processStacyRequest",r),W("Oups, quelque chose s'est mal pass√©. Veuillez r√©essayer.","model")}finally{t&&(t.disabled=!1,y&&t.focus())}}async function st(e){const t=e.name||e.functionName||e.fn,n=e.args||e.arguments||e.params||{};switch(t){case"searchProducts":{const r=String(n.keywords||n.q||""),o=await ct(r);return{success:!!o.success,action:"searchProducts",result:o}}case"manageCart":{const r=await it(n);return{success:!!r.success,action:"manageCart",result:r}}case"redirectToVerifyPage":{const r=await dt();return{success:!!r.success,action:"redirectToVerifyPage",result:r}}case"getContextDelta":return{success:!0,action:"getContextDelta",result:lt()};default:return console.warn(`[Stacy] functionCall non g√©r√© c√¥t√© client: ${t}`),{success:!1,action:String(t),result:{displayText:`Action demand√©e inconnue c√¥t√© client: ${String(t)}`,reason:"unknown"}}}}async function ct(e){const t=await _e(),n=String(e||"").toLowerCase().split(" ").filter(o=>o),r=t.filter(o=>n.every(a=>o.title.toLowerCase().includes(a)));return r.length>0?{success:!0,products:r.slice(0,3).map(a=>({id:a.id,title:a.title,price:a.price,shortDescription:a.shortDescription,url:a.url})),displayText:`J'ai trouv√© ${r.length} produit(s).`}:{success:!1,displayText:`D√©sol√©, je n'ai trouv√© aucun produit pour "${h(String(e))}".`}}async function it(e){const{action:t,productId:n,quantity:r=1}=e;switch(t){case"add":{if(!n)return{success:!1,displayText:"Je ne sais pas quel produit ajouter."};const a=(await _e()).find(i=>i.id===n);return a?(xe(a,r),{success:!0,displayText:`J'ai ajout√© ${r}x "${a.title}" √† votre panier.`}):{success:!1,displayText:`Je n'ai pas trouv√© le produit avec l'ID ${n}.`}}case"remove":return n?(Ie(n),{success:!0,displayText:"L'article a √©t√© retir√© de votre panier."}):{success:!1,displayText:"Je ne sais pas quel produit retirer."};case"list":default:{const o=_();return!o||o.length===0?{success:!0,cart:[],displayText:"Votre panier est actuellement vide."}:{success:!0,cart:o,displayText:`Votre panier contient ${o.length} article(s).`}}}}function lt(){const e=document.querySelector("#app-content main");return{pageType:(e==null?void 0:e.dataset.pageType)||"unknown",pageTitle:document.title,url:window.location.href,productContext:M().product||null}}async function dt(){if(re)try{return re.navigateTo("/verify/"),oe(),{success:!0,displayText:"[Action Syst√®me] Redirection vers /verify/ effectu√©e."}}catch(e){return console.warn("[Stacy] Router navigation failed",e),{success:!1,displayText:"[Action Syst√®me] Routeur non disponible."}}else return{success:!1,displayText:"[Action Syst√®me] Routeur non disponible."}}function oe(){const e=document.querySelector("[data-stacy-window]"),t=document.querySelector("[data-stacy-fab-button]");if(!e||!t)return;y=!y,e.classList.toggle("is-open",y),t.setAttribute("aria-expanded",String(y));const n=t.querySelector('[data-stacy-icon="chat"]'),r=t.querySelector('[data-stacy-icon="close"]');if(n&&r&&(n.style.opacity=y?"0":"1",r.style.opacity=y?"1":"0"),y){tt();const o=document.querySelector("[data-stacy-input]");o&&setTimeout(()=>o.focus(),50)}}function ut(){const e=document.querySelector("[data-stacy-fab-button]");e&&e.addEventListener("click",oe);const t=document.querySelector("[data-stacy-form]");if(t){t.addEventListener("submit",ot);const r=t.querySelector("[data-stacy-input]");r&&r.addEventListener("keydown",o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),t.requestSubmit())})}document.addEventListener("keydown",r=>{r.key==="Escape"&&y&&oe()});const n=document.querySelector("[data-stacy-delete]");n&&n.addEventListener("click",async()=>{try{const r=M().storeId;if(!r)throw new Error("storeId introuvable");await Be(r)}catch(r){console.error("[Stacy] delete conv failed",r),Y({text:"Impossible de supprimer la conversation."},"model")}})}function mt(e){document.querySelector("[data-stacy-fab]")&&(re=e,ut(),console.log("[Stacy] Module V7.5 (Brain Upgrade) initialis√©."))}function H(){const e=document.getElementById("search-modal"),t=document.getElementById("search-input");if(!e||!t)return;!e.classList.contains("hidden")?(e.classList.add("opacity-0"),setTimeout(()=>e.classList.add("hidden"),300)):(e.classList.remove("hidden"),requestAnimationFrame(()=>e.classList.remove("opacity-0")),t.focus())}function ft(e){const t=document.getElementById("search-results");if(t){if(e.length===0){t.innerHTML='<p class="text-center p-4" style="color: var(--text-muted-color);">Aucun r√©sultat trouv√©. Veuillez consulter notre assistante Stacy pour plus de recommandations.</p>';return}t.innerHTML=e.map(n=>`
    <a href="${n.url}" class="flex items-center p-3 hover:bg-gray-100/50 transition-colors zflex-link border-b" style="border-color: var(--card-border-color);">
      <img src="${n.coverImage}" alt="${n.title}" class="w-12 h-12 object-cover rounded-md mr-4 flex-shrink-0">
      <div class="flex-grow">
        <h4 class="font-semibold" style="color: var(--text-color);">${n.title}</h4>
        <p class="text-sm font-bold" style="color: var(--primary-color);">${n.price.amount.toFixed(2)} ${n.price.currency}</p>
      </div>
    </a>
  `).join("")}}async function pt(){const e=document.getElementById("search-toggle-btn"),t=document.getElementById("search-modal"),n=document.getElementById("search-modal-overlay"),r=document.getElementById("search-input"),o=document.getElementById("search-results");if(!e||!t||!r||!n||!o)return;const a=await K();e.addEventListener("click",H),n.addEventListener("click",H),r.addEventListener("input",()=>{const i=r.value.trim().toLowerCase();if(i.length<2){o.innerHTML='<p class="text-center p-4" style="color: var(--text-muted-color);">Tapez au moins 2 caract√®res pour rechercher.</p>';return}const s=a.filter(c=>c.title.toLowerCase().includes(i)).slice(0,5);ft(s)}),document.addEventListener("keydown",i=>{i.key==="Escape"&&!t.classList.contains("hidden")&&H()}),o.addEventListener("click",i=>{i.target.closest("a")&&H()})}function gt(){const e=document.getElementById("site-header");if(!e||e.dataset.variant!=="transparent")return;const t=()=>{window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled")};window.addEventListener("scroll",t,{passive:!0}),t()}function yt(){const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-menu");!e||!t||e.addEventListener("click",()=>{t.classList.toggle("hidden")})}function ht(){const e=document.getElementById("settings-toggle-btn"),t=document.getElementById("settings-menu");!e||!t||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.toggle("hidden")}),document.addEventListener("click",()=>{t.classList.add("hidden")}))}function wt(){gt(),yt(),ht(),console.log("[GlobalUI] Module initialis√©.")}const De="zflex_analytics_queue_v1",vt=1e4,Et=50,bt=3,Ct=150;let p=[],ee=!1,te=null,we=0;function St(){try{const e=localStorage.getItem(De);e&&(p=JSON.parse(e))}catch(e){console.warn("[Analytics] Load queue failed.",e),p=[]}}function de(){try{localStorage.setItem(De,JSON.stringify(p))}catch(e){console.warn("[Analytics] Persist queue failed.",e)}}function xt(e,t={}){var r;const n=ue()||{};return{type:e,payload:t,storeId:n.storeId||null,context:{pageType:((r=document.querySelector("main"))==null?void 0:r.dataset.pageType)||null,title:document.title,url:window.location.href},ts:new Date().toISOString(),version:n.zflex_version||null}}function w(e,t={}){if(!e)return;const n=xt(e,t);p.push(n),de(),console.log(`[Analytics] Event Queued: ${e}`,t)}async function Oe(e,t=1){if(!e||e.length===0)return{ok:!0};try{const n=e[0].storeId;return n?await Xe(n,e):{ok:!1,error:"Missing storeId"}}catch(n){return t<bt?(await new Promise(r=>setTimeout(r,1e3*t)),Oe(e,t+1)):{ok:!1,error:String(n)}}}async function ae(){if(!(ee||p.length===0)){ee=!0;try{const e=p.slice(0,Et),t=await Oe(e);t&&t.ok&&(p.splice(0,e.length),de())}finally{ee=!1}}}function It(){te&&clearInterval(te),te=setInterval(ae,vt),document.addEventListener("visibilitychange",()=>document.visibilityState==="hidden"&&ae()),window.addEventListener("beforeunload",()=>{var e;if(p.length!==0)try{const t=ue(),n=(e=t.apiEndpoints)==null?void 0:e.trackEvent;navigator.sendBeacon&&n&&(navigator.sendBeacon(n,JSON.stringify({storeId:t.storeId,events:p})),p=[],de())}catch(t){console.warn("[Analytics] Beacon failed.",t)}})}function Lt(){const e={"stacy:message_sent":t=>w("send_stacy_message",{length:t.message.length}),"cart:item_added":t=>w("add_to_cart",t.item),"cart:item_removed":t=>w("remove_from_cart",t.item),"cart:cleared":()=>w("clear_cart"),"checkout:purchase_success":t=>w("purchase",t.order)};for(const[t,n]of Object.entries(e))q.addEventListener(t,r=>n(r.detail))}function Tt(e){const t=e.getAttribute("data-analytics-type")||"",n=e.getAttribute("data-analytics-payload");let r={};if(n)try{r=JSON.parse(n)}catch(o){console.warn("[Analytics] √âchec parsing payload, attribut brut:",{payloadAttr:n,error:o})}return{type:t,payload:r}}function kt(){document.addEventListener("click",e=>{const t=Date.now();if(t-we<Ct){e.stopImmediatePropagation();return}we=t;const n=e.target.closest("[data-analytics-type]");if(!n)return;const{type:r,payload:o}=Tt(n);r&&w(r,o)},!0)}function _t(){St(),It(),kt(),Lt(),console.log("[Analytics] Module V3.2 (The Final Cut) initialis√©.")}function se({path:e,title:t,extra:n={}}={}){w("pageview",{url:e||window.location.href,title:t||document.title,...n})}function At(e,t={}){w(e,t)}window.zflexAnalytics={track:At,trackPageview:se,flush:ae,getQueue:()=>p};const ve={isScrolling:!1,init(){this.bindEventListeners(),window.addEventListener("popstate",()=>this.handleLocationChange());try{se()}catch(e){console.warn("[Router] Le tracking de la page initiale a √©chou√©:",e)}console.log("[Router] Initialis√© en mode GATEKEEPER.")},handleLinkClick(e){if(this.isScrolling)return;const t=e.target.closest("a.zflex-link");if(!t||t.target==="_blank")return;const n=new URL(t.href);if(n.hash&&n.pathname===window.location.pathname){e.preventDefault();const r=document.querySelector(n.hash);r&&r.scrollIntoView({behavior:"smooth",block:"start"});return}n.origin===window.location.origin&&(e.preventDefault(),this.navigateTo(n.pathname))},bindEventListeners(){document.body.addEventListener("touchstart",()=>{this.isScrolling=!1},{passive:!0}),document.body.addEventListener("touchmove",()=>{this.isScrolling=!0},{passive:!0}),document.body.addEventListener("click",this.handleLinkClick.bind(this)),document.body.addEventListener("touchend",this.handleLinkClick.bind(this))},navigateTo(e){e!==window.location.pathname&&(history.pushState({path:e},"",e),this.handleLocationChange())},async handleLocationChange(){const e=window.location.pathname;console.log(`[Router] Navigation d√©tect√©e vers : ${e}`);const t=e==="/"||e===""?"/content/home.html":`/content${e.replace(/\/$/,"")}.html`,n=document.getElementById("app-content"),r=document.getElementById("router-loader");if(!n){console.error("ERREUR CRITIQUE: Conteneur #app-content introuvable.");return}r&&r.classList.remove("hidden"),n.style.opacity="0.5",n.style.transition="opacity 0.3s ease-in-out";try{const o=await fetch(t);if(!o.ok){if(o.status===404){const s=await(await fetch("/content/404.html")).text();this.updatePageContent(s,"404 - Page non trouv√©e");return}throw new Error(`Erreur serveur: ${o.statusText}`)}const a=await o.text();this.updatePageContent(a)}catch(o){console.error("Erreur de routage critique:",o),n.innerHTML=`
        <div class="text-center py-20">
          <h1 class="text-2xl font-bold">Erreur de chargement</h1>
          <p class="text-gray-600 mt-2">${o.message}</p>
          <button onclick="window.location.reload()" class="mt-4 bg-primary text-white font-bold py-2 px-4 rounded">Recharger la page</button>
        </div>
      `}finally{r&&r.classList.add("hidden"),document.body.contains(n)&&(n.style.opacity="1"),window.scrollTo(0,0)}},updatePageContent(e,t=null){const n=document.getElementById("app-content"),r=document.getElementById("zflex-data"),i=new DOMParser().parseFromString(e,"text/html").querySelector("main");if(i&&r){const s=i.querySelector(".zflex-fragment-data");s&&(r.textContent=s.textContent,s.remove()),document.title=t||i.dataset.pageTitle||document.title,n.innerHTML="",n.appendChild(i),Me();try{se()}catch(c){console.warn("[Router] Le tracking de la nouvelle page a √©chou√©:",c)}}else console.error("Erreur critique: <main> ou #zflex-data manquant.")}};function Pt(){try{const e=document.getElementById("zflex-data");return e?JSON.parse(e.textContent||"{}"):{}}catch(e){return console.error("[Stacy] getPageData parse error",e),{}}}function Bt(){const e=document.getElementById("newsletter-form"),n=Pt().storeId;if(!e){console.warn("Newsletter form not found. Skipping initialization.");return}e.addEventListener("submit",async r=>{r.preventDefault();const o=e.querySelector('input[type="email"]');if(!o){console.error("Email input not found in newsletter form."),C("Erreur","Impossible de trouver le champ email.","error");return}const a=o.value.trim();if(!a){C("Attention","Veuillez entrer une adresse email valide.","warning");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)){C("Attention","Le format de l'adresse email est invalide.","warning");return}const i=e.querySelector('button[type="submit"]');i&&(i.disabled=!0,i.textContent="Envoi..."),o.disabled=!0;try{const s=await Ye(a,n);if(s&&s.success)C("Merci !",`Vous √™tes maintenant inscrit avec l'adresse : ${a}`,"success"),e.reset();else{const c=(s==null?void 0:s.message)||"Une erreur est survenue lors de l'inscription. Veuillez r√©essayer.";C("Erreur",c,"error")}}catch(s){console.error("Newsletter subscription error:",s),C("Erreur","Une erreur inattendue est survenue. Veuillez r√©essayer plus tard.","error")}finally{i&&(i.disabled=!1,i.textContent="S'abonner"),o.disabled=!1}})}let O;function Dt(){const e=document.getElementById("install-app-btn");e&&(console.log("[PWA] L'application est maintenant installable."),e.disabled=!1,e.classList.remove("opacity-50","cursor-not-allowed"),e.addEventListener("click",Ot,{once:!0}))}function qe(){const e=document.getElementById("install-app-btn"),t=document.getElementById("app-installed-message");e&&t&&(e.classList.add("hidden"),t.classList.remove("hidden"))}async function Ot(){if(!O)return;O.prompt();const{outcome:e}=await O.userChoice;e==="accepted"?(console.log("[PWA] L'utilisateur a accept√© l'installation."),qe()):console.log("[PWA] L'utilisateur a refus√© l'installation."),O=null}function qt(){window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone?(console.log("[PWA] D√©tect√© comme une application install√©e."),qe()):window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),O=e,Dt()}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(()=>console.log("[PWA] Service Worker OK.")).catch(e=>console.error("[PWA] Service Worker KO:",e))}let Ee=!1,D=null;function ue(){const e=document.getElementById("zflex-data");if(!e||!e.textContent)return console.warn("[App] Tunnel de data #zflex-data est vide ou introuvable."),{};try{return JSON.parse(e.textContent)}catch(t){return console.error("[App] Erreur de parsing du tunnel de data #zflex-data:",t),{}}}const be={"product-detail":async()=>{const{initProductGallery:e}=await B(async()=>{const{initProductGallery:t}=await import("../assets/product-gallery-CW4kno63.js");return{initProductGallery:t}},[]);return Ke(),e(),{destroy:()=>console.log("[App] Cleanup: product-detail")}},"category-view":async()=>{const{initFilterSort:e}=await B(async()=>{const{initFilterSort:t}=await Promise.resolve().then(()=>Fe);return{initFilterSort:t}},void 0);return e(),{destroy:()=>console.log("[App] Cleanup: category-view")}},cart:async()=>(We(),{destroy:()=>console.log("[App] Cleanup: cart")}),checkout:async()=>{const{initCheckout:e}=await B(async()=>{const{initCheckout:t}=await import("../assets/checkout-D8mBWSwY.js");return{initCheckout:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: checkout")}},"order-success":async()=>{const{initOrderSuccess:e}=await B(async()=>{const{initOrderSuccess:t}=await import("../assets/order-success-DaRlGU8P.js");return{initOrderSuccess:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: order-success")}},verify:async()=>{const{initVerifyPage:e}=await B(async()=>{const{initVerifyPage:t}=await import("../assets/verify-Bve0uL8W.js");return{initVerifyPage:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: verify")}},"not-found":async()=>({destroy:()=>console.log("[App] Cleanup: not-found")}),unknown:async()=>({destroy:()=>{}})};async function Me(){var r;D&&typeof D.destroy=="function"&&D.destroy();const e=document.querySelector("#app-content main"),t=((r=e==null?void 0:e.dataset)==null?void 0:r.pageType)||"unknown";console.log(`[App] Chargement des scripts pour la page: "${t}"`);const n=be[t]||be.unknown;try{D=await n()}catch(o){console.error(`[App] Erreur lors du chargement du module pour "${t}":`,o),D=null}Bt()}function Mt(){console.log("[Preview] Initialisation du mode √©diteur temps r√©el");const e={"palette.primary":"--primary-color","palette.secondary":"--secondary-color","palette.background":"--bg-color","palette.text":"--text-color","palette.accent":"--accent-color","palette.cardBackground":"--card-bg-color","palette.textMuted":"--text-muted-color","palette.cardBorder":"--card-border-color","palette.inputBackground":"--input-bg-color","palette.chatResponseBackground":"--chat-response-bg-color",primary:"--primary-color",secondary:"--secondary-color",background:"--bg-color",text:"--text-color",accent:"--accent-color",cardBackground:"--card-bg-color","primary-color":"--primary-color","bg-color":"--bg-color","card-bg-color":"--card-bg-color"};function t(s){if(!s)return null;if(typeof s=="string"&&s.startsWith("--"))return s;const c=String(s).trim();if(e[c])return e[c];const l=c.replace(/^palette[\._-]?/i,"").replace(/\./g,"").replace(/_/g,"").toLowerCase(),d={primary:"--primary-color",primary600:"--primary-600",primary700:"--primary-700",secondary:"--secondary-color",secondary600:"--secondary-600",background:"--bg-color",text:"--text-color",accent:"--accent-color",cardbackground:"--card-bg-color",textmuted:"--text-muted-color",cardborder:"--card-border-color",inputbackground:"--input-bg-color",chatresponsebackground:"--chat-response-bg-color"};return d[l]?d[l]:`--${c.replace(/^palette[\._-]?/i,"").replace(/\./g,"-").replace(/_/g,"-").toLowerCase()}`}function n(s={}){if(!s||typeof s!="object")return;const c=document.documentElement;Object.keys(s).forEach(l=>{const d=s[l];if(typeof d!="string"&&typeof d!="number")return;const u=l.startsWith("--")?l:t(l)||`--${l}`;c.style.setProperty(u,String(d))}),window.requestAnimationFrame(()=>{document.body.offsetHeight})}function r(s){if(!s)return;const c=s.computed||{},l=s.palette||{},d={};Object.keys(l).forEach(u=>{const m=t(u)||t(`palette.${u}`)||`--${u}`;d[m]=l[u]}),Object.keys(c).forEach(u=>{const m=t(u)||`--${u.replace(/[A-Z]/g,f=>"-"+f.toLowerCase())}`;d[m]=c[u]}),n(d),console.log("[Preview] Applied computed palette vars:",d)}function o(s){if(s==null)return"";let c=String(s).trim();return/^[0-9A-Fa-f]{6}$/.test(c)&&(c="#"+c),c}function a(s){if(!s)return;let{property:c,value:l}=s;const d=t(c)||c,u=o(l);d&&(document.documentElement.style.setProperty(d,u),(d.includes("color")||d.includes("bg")||d.includes("background"))&&(document.body.style.transition="background-color 0.22s ease, color 0.22s ease, border-color 0.22s ease",setTimeout(()=>{document.body.style.transition=""},300)),console.log(`[Preview] Mise √† jour style (incoming: ${String(c)}) -> canonical: ${d}: ${u}`))}function i(s){if(!s)return;const{id:c,value:l}=s,d=document.querySelector(`[data-zflex-id="${c}"]`);if(!d){console.warn(`[Preview] √âl√©ment avec data-zflex-id="${c}" non trouv√©`);return}d.tagName==="IMG"?(d.src=l,d.alt=l||""):d.textContent=l,d.style.transition="all 0.18s ease",d.style.transform="scale(1.01)",setTimeout(()=>{d.style.transform=""},220)}window.addEventListener("message",s=>{if(!(s!=null&&s.data))return;const c=s.data;if(c.source==="zflex-admin")switch(console.log("[Preview] Message re√ßu de l'√©diteur:",c),c.action){case"updateElement":i(c.payload);break;case"updateStyle":a(c.payload);break;case"updatePalette":r(c.payload);break;default:console.warn("[Preview] Action non reconnue:",c.action)}}),window.parent!==window&&window.parent.postMessage({source:"zflex-preview",action:"ready",payload:{url:window.location.href}},"*")}function Ce(){if(Ee)return;console.log("[App] D√©marrage zFlex ‚Äî L'Architecture Finale.");const e=new URLSearchParams(window.location.search).get("preview")==="true";e?(console.log("[App] Mode Preview activ√© - D√©sactivation des interactions utilisateur"),document.body.style.pointerEvents="none",document.body.style.cursor="not-allowed",Mt()):console.log("[App] Mode normal - Initialisation des scripts interactifs");try{if(!window.firebase||!window.firebase.initializeApp)throw new Error("Le SDK Firebase (compat) n'a pas √©t√© charg√©. V√©rifie les scripts dans _head.njk.");const n=document.getElementById("firebase-config-data");if(!n)throw new Error("Firebase config data island not found.");const r=JSON.parse(n.textContent||"{}");if(!r.apiKey)throw new Error("Firebase apiKey is missing.");window.firebase.initializeApp(r),console.log("[Firebase] Initialisation via le scope global r√©ussie.")}catch(n){console.error("[Firebase] √âCHEC CRITIQUE DE L'INITIALISATION :",n);return}e||(Ge(),mt(ve),wt(),pt(),je(),qt(),_t(),ve.init()),Me(),Ee=!0;const t=["color: #00BFFF","font-size: 12px","font-family: monospace","background: #0E0E0E","padding: 4px 8px","border-radius: 4px"].join(";");console.log("%c Fearless Engine: Online. Status: Flawless. ",t),window.location.hostname==="localhost"||window.location.hostname.includes("192.168.")?(console.log("------------------"),console.log("< Happy Hacking! ‚Äî Fearless >"),console.log("------------------"),console.log("        \\   ^__^"),console.log("         \\  (oo)\\_______"),console.log("            (__)\\       )/\\"),console.log("                ||----w |"),console.log("                ||     ||"),console.log(`
version: dev (local)`)):(console.log("------------------"),console.log("< Ready for Action! ‚Äî Fearless >"),console.log("------------------"),console.log("        \\   ^__^"),console.log("         \\  (oo)\\_______"),console.log("            (__)\\       )/\\"),console.log("                ||----w |"),console.log("                ||     ||"),console.log(`
version: production (${new Date().toISOString().slice(0,10)})`))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ce,{once:!0}):Ce();export{B as _,Ft as a,zt as b,Ht as c,$t as d,q as e,Nt as f,_ as g,Rt as i,ve as r,C as s};
