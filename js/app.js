const we="modulepreload",Ee=function(e){return"/"+e},re={},C=function(t,n,r){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),i=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));o=Promise.allSettled(n.map(l=>{if(l=Ee(l),l in re)return;re[l]=!0;const c=l.endsWith(".css"),p=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${p}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":we,c||(d.as="script"),d.crossOrigin="",d.href=l,i&&d.setAttribute("nonce",i),document.head.appendChild(d),c)return new Promise((h,m)=>{d.addEventListener("load",h),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(s){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=s,window.dispatchEvent(i),!i.defaultPrevented)throw s}return o.then(s=>{for(const i of s||[])i.status==="rejected"&&a(i.reason);return t().catch(a)})};let P=[],oe=!1,H=null;async function z(){if(oe)return P;try{const e=await fetch("/api/search-index.json");if(!e.ok)throw new Error(`Erreur réseau: ${e.statusText}`);return P=await e.json(),oe=!0,P}catch(e){return console.error("[FilterSort] Impossible de charger l'index des produits:",e),[]}}function Se(e,t){const n=[...e];switch(t){case"price-asc":n.sort((r,o)=>r.price.amount-o.price.amount);break;case"price-desc":n.sort((r,o)=>o.price.amount-r.price.amount);break;case"name-asc":n.sort((r,o)=>r.title.localeCompare(o.title));break;case"name-desc":n.sort((r,o)=>o.title.localeCompare(r.title));break}return n}function be(e){const t=document.getElementById("product-grid");if(t){if(!H){const n=t.querySelector(".product-card");if(!n)return;H=n.cloneNode(!0)}if(t.innerHTML="",e.length===0){t.innerHTML='<p class="col-span-full text-center text-gray-500 py-8">Aucun produit ne correspond à votre sélection.</p>';return}e.forEach(n=>{const r=H.cloneNode(!0),o=r.querySelector("a"),a=r.querySelector("img"),s=r.querySelector("h4"),i=r.querySelector(".product-price");o&&(o.href=n.url),a&&(a.src=n.coverImage,a.alt=n.title),s&&(s.textContent=n.title),i&&n.price&&(i.textContent=`${n.price.amount.toFixed(2)} ${n.price.currency}`),t.appendChild(r)})}}async function Ie(){if(!document.getElementById("product-controls"))return;await z();const t=JSON.parse(document.getElementById("zflex-data").textContent),n=t.category?t.category.id:null;if(!n)return;const r=P.filter(c=>c.categoryId===n),o=document.getElementById("sort-dropdown");if(!o)return;const a=document.getElementById("sort-btn"),s=document.getElementById("sort-label"),i=document.getElementById("sort-options"),l=i.querySelectorAll(".sort-option");a.addEventListener("click",c=>{c.stopPropagation(),i.classList.toggle("hidden")}),l.forEach(c=>{c.addEventListener("click",p=>{p.preventDefault();const d=c.dataset.value,h=c.textContent;s.textContent=`Trier par : ${h}`,i.classList.add("hidden");const m=Se(r,d);be(m)})}),document.addEventListener("click",c=>{o.contains(c.target)||i.classList.add("hidden")}),console.log("[FilterSort] Module initialisé.")}const Ce=Object.freeze(Object.defineProperty({__proto__:null,fetchProductIndex:z,initFilterSort:Ie},Symbol.toStringTag,{value:"Module"})),k=window.zflexEventBus||new EventTarget;window.zflexEventBus=k;let S,j,K,$,B,b,q,O,D,M=null,R=null;function X(){S&&(S.classList.add("hidden"),M=null,R=null)}function Le(e){if(typeof M=="function")try{M()}catch(t){console.error("[Dialog] Erreur dans onConfirm:",t)}X()}function xe(e){if(typeof R=="function")try{R()}catch(t){console.error("[Dialog] Erreur dans onCancel:",t)}X()}function v(e,t,n={}){if(!S){alert(`${e}

${t}`),n.onConfirm&&n.onConfirm();return}q.classList.add("hidden"),O.classList.add("hidden"),D.classList.add("hidden"),n.variant==="success"?q.classList.remove("hidden"):n.variant==="error"?O.classList.remove("hidden"):D.classList.remove("hidden"),K.textContent=e,n.messageHtml?$.innerHTML=n.messageHtml:$.textContent=t||"",B.textContent=n.confirmText||"OK",n.cancelText?(b.classList.remove("hidden"),b.textContent=n.cancelText):b.classList.add("hidden"),M=typeof n.onConfirm=="function"?n.onConfirm:null,R=typeof n.onCancel=="function"?n.onCancel:null,S.classList.remove("hidden")}function ke(){if(S=document.getElementById("zflex-dialog"),!!S){if(j=document.getElementById("dialog-overlay"),K=document.getElementById("dialog-title"),$=document.getElementById("dialog-message"),B=document.getElementById("dialog-confirm-btn"),b=document.getElementById("dialog-cancel-btn"),q=document.getElementById("dialog-icon-success"),O=document.getElementById("dialog-icon-error"),D=document.getElementById("dialog-icon-info"),!j||!K||!$||!B||!q||!O||!D||!b){console.error("[Dialog] Un ou plusieurs éléments internes du dialog sont manquants. Vérifie les IDs."),S=null;return}j.addEventListener("click",X),B.addEventListener("click",Le),b.addEventListener("click",xe),k.addEventListener("dialog:show",e=>{const t=e.detail||{},{title:n,message:r,variant:o}=t,a={variant:o,onConfirm:t.onConfirm,onCancel:t.onCancel,confirmText:t.confirmText,cancelText:t.cancelText,messageHtml:t.messageHtml};v(n,r,a)}),console.log("[Dialog] Module initialisé et prêt (callbacks & HTML).")}}const me="zflex_cart";function I(){return JSON.parse(localStorage.getItem(me))||[]}function F(e){localStorage.setItem(me,JSON.stringify(e)),window.dispatchEvent(new CustomEvent("cartUpdated"))}function _e(e,t=1){const n=I(),r=n.find(o=>o.id===e.id);r?r.quantity+=t:n.push({id:e.id,title:e.title,price:e.price,coverImage:e.coverImage,url:e.url,quantity:t}),F(n)}function Te(e,t){let n=I();const r=n.find(o=>o.id===e);r&&(t>0?r.quantity=t:n=n.filter(o=>o.id!==e),F(n))}function Ae(e){const t=I().filter(n=>n.id!==e);F(t)}function Ct(){F([])}function ae(){const e=document.getElementById("cart-count");if(!e)return;const n=I().reduce((r,o)=>r+o.quantity,0);e.textContent=n,e.style.display=n>0?"flex":"none",n>0&&(e.classList.add("updated"),setTimeout(()=>{e.classList.remove("updated")},300))}function fe(){if(!document.querySelector('[data-page-type="cart"]'))return;const t=document.getElementById("cart-items-list"),n=document.getElementById("cart-subtotal"),r=document.getElementById("cart-total"),o=document.getElementById("cart-empty-state"),a=document.getElementById("cart-content");if(!t||!n||!r||!o||!a){console.error("[Cart] Erreur critique: DOM manquant dans cart.njk.");return}const s=I(),i=document.getElementById("cart-item-template");if(!i){console.error("[Cart] Erreur critique: le template #cart-item-template est manquant.");return}if(s.length===0){o.classList.remove("hidden"),a.classList.add("hidden");return}o.classList.add("hidden"),a.classList.remove("hidden"),t.innerHTML="";let l={};s.forEach(c=>{var te,ne;const p=Number(((te=c.price)==null?void 0:te.amount)||0),d=((ne=c.price)==null?void 0:ne.currency)||"EUR",h=Number(c.quantity||1),m=i.content.cloneNode(!0);m.querySelector('[data-template-field="image"]').src=c.coverImage||"",m.querySelector('[data-template-field="title"]').textContent=c.title||"Produit sans nom",m.querySelector('[data-template-field="url"]').href=c.url||"#",m.querySelector('[data-template-field="price"]').textContent=`${p.toFixed(2)} ${d}`;const V=m.querySelector('[data-template-field="quantity"]');V.value=h,m.querySelector('[data-template-field="total"]').textContent=`${(p*h).toFixed(2)} ${d}`,V.addEventListener("change",()=>Te(c.id,parseInt(V.value,10))),m.querySelector('[data-template-field="remove-btn"]').addEventListener("click",()=>Ae(c.id)),t.appendChild(m),l[d]||(l[d]=0),l[d]+=p*h}),n.innerHTML="",r.innerHTML="",Object.entries(l).forEach(([c,p])=>{const d=`${Number(p).toFixed(2)} ${c}`;n.innerHTML+=`<div>${d}</div>`,r.innerHTML+=`<div>${d}</div>`})}function Pe(){document.querySelector('[data-page-type="cart"]')&&(console.log("[Cart] Initialisation de la page panier..."),fe())}async function Be(){document.querySelectorAll("#add-to-cart-btn").forEach(e=>{e.dataset.listenerAttached||(e.addEventListener("click",async()=>{e.disabled=!0;try{const t=document.getElementById("zflex-data");if(!t)throw new Error("Erreur critique: Tunnel de data #zflex-data manquant.");const n=JSON.parse(t.textContent);if(!(n!=null&&n.product))throw new Error("Données du produit non trouvées dans le tunnel de data.");const o=(await z()).find(a=>a.id===n.product.id);if(o)_e(o),k.dispatchEvent(new CustomEvent("dialog:show",{detail:{title:"Ajouté au panier !",message:`${o.title.trim()} a bien été ajouté.`,variant:"success"}}));else throw new Error("Produit introuvable dans l'index de recherche.")}catch(t){console.error("Erreur lors de l'ajout au panier:",t),k.dispatchEvent(new CustomEvent("dialog:show",{detail:{title:"Erreur",message:t.message||"Impossible d'ajouter ce produit au panier.",variant:"error"}}))}finally{e.disabled=!1}}),e.dataset.listenerAttached="true")})}function $e(){ae(),window.addEventListener("cartUpdated",()=>{ae(),fe()}),console.log("[Cart] Module global initialisé.")}async function g(e,t){var o;const r=(o=ee().apiEndpoints)==null?void 0:o[e];if(!r)throw new Error(`Endpoint API pour "${e}" non trouvé. Vérifiez la configuration du builder.`);try{const a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await a.json();if(!a.ok){const i=s.error||`Erreur ${a.status}`;throw new Error(i)}return s}catch(a){throw console.error(`[API] Erreur pour "${e}":`,a),new Error("La communication avec nos services a échoué. Veuillez réessayer.")}}function qe(e,t){return g("createConv",{storeId:e,context:t})}function Oe(e,t,n,r){return g("stacy",{storeId:e,convId:t,message:n,contextDelta:r})}function Lt(e,t){return g("createOrder",{...e,storeId:t})}function xt(e,t){return g("getOrderDetails",{orderId:e,storeId:t})}function kt(e,t,n,r,o){return g("initiatePayment",{orderId:e,storeId:t,paymentMethod:n,paymentPhone:r,transactionReference:o})}function _t(e,t){return g("getOrderStatusApi",{orderId:e,storeId:t})}function Tt(e,t){return g("getProspectInfo",{storeId:e,prospectId:t})}function De(e,t){return g("subscribeToNewsletter",{email:e,storeId:t})}function Me(e,t){return g("trackEvent",{storeId:e,events:t})}let E=!1,_=[],se=!1,T=null,G=null;const Re=24*60*60*1e3,Ne=e=>`stacy_conv_${e}`;function N(){try{const e=document.getElementById("zflex-data");return e?JSON.parse(e.textContent||"{}"):{}}catch(e){return console.error("[Stacy] Erreur de parsing des données de la page",e),{}}}async function ze(){if(T)return T;try{const e=await fetch("/api/search-index.json");if(!e.ok)throw new Error("Réponse réseau non OK");return T=await e.json(),T}catch(e){return console.error("[Stacy] Impossible de charger l'index de recherche:",e),[]}}function w(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Fe(e){try{if(/^(https?:|mailto:)/i.test(String(e).trim()))return String(e).trim()}catch{}return"#"}function Ve(e){let t=w(e);return t=t.replace(/```([\s\S]*?)```/g,(n,r)=>`<pre class="stacy-code"><code>${w(r)}</code></pre>`),t=t.replace(/`([^`]+)`/g,(n,r)=>`<code class="stacy-inline-code">${w(r)}</code>`),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(n,r,o)=>`<a href="${Fe(o)}" target="_blank" rel="noopener noreferrer" class="zflex-link">${w(r)}</a>`),t=t.replace(/\*\*([^*]+)\*\*/g,(n,r)=>`<strong>${w(r)}</strong>`),t=t.replace(/\*([^*]+)\*/g,(n,r)=>`<em>${w(r)}</em>`),t=t.replace(/\r?\n/g,"<br>"),t}function u(e,t){const n=document.querySelector("[data-stacy-messages]");if(!n)return;const r=document.createElement("div");if(r.className="p-2 my-1 rounded-lg max-w-[85%] text-sm break-words",t==="user")r.classList.add("bg-primary/20","self-end"),r.textContent=e;else{r.classList.add("self-start");const o=getComputedStyle(document.documentElement).getPropertyValue("--chat-response-bg-color").trim()||"#f3f4f6";r.style.backgroundColor=o,r.innerHTML=Ve(e)}n.appendChild(r),n.scrollTop=n.scrollHeight}function He(){const e=document.querySelector("[data-stacy-messages]");if(!e)return null;const t=document.createElement("div");return t.className="p-2 my-1 rounded-lg max-w-[60%] self-start text-sm break-words stacy-typing",t.innerHTML='<div class="typing-indicator"><span></span><span></span><span></span></div>',e.appendChild(t),e.scrollTop=e.scrollHeight,t}async function je(e){const t=Ne(e);try{const n=localStorage.getItem(t);if(n){const o=JSON.parse(n);if(Date.now()-(o.createdAt||0)<=Re)return o.convId}const r=await qe(e);if(!(r!=null&&r.convId))throw new Error("createConversation n'a pas retourné de convId");return localStorage.setItem(t,JSON.stringify({convId:r.convId,createdAt:Date.now()})),r.convId}catch(n){throw console.error("[Stacy] Erreur getOrCreateConvId",n),n}}function Je(){if(se)return;const n=`Salut ! Je suis Stacy, l'assistante de ${N().storeName||"la boutique"}. Comment puis-je vous aider ?`;u(n,"stacy"),_.push({role:"model",parts:[{text:n}]}),se=!0}async function Ue(e){e.preventDefault();const n=e.target.querySelector("[data-stacy-input]");if(!n)return;const r=n.value.trim();r&&(u(r,"user"),_.push({role:"user",parts:[{text:r}]}),n.value="",await pe(r))}async function pe(e,t=!1){var o;const n=document.querySelector("[data-stacy-input]");n&&(n.disabled=!0);const r=He();try{const s=N().storeId;if(!s)throw new Error("storeId introuvable");const i=await je(s),l=await Oe(s,i,e);r&&r.remove();const c=(l==null?void 0:l.answer)??"Désolé, une erreur est survenue.";u(c,"stacy"),_.push({role:"model",parts:[{text:c}]}),(o=l.functionResult)!=null&&o.success&&await Ke(l.functionResult)}catch(a){r&&r.remove(),console.error("[Stacy] Erreur processStacyRequest",a),u("Oups, quelque chose s'est mal passé. Veuillez réessayer.","stacy")}finally{n&&(n.disabled=!1,E&&n.focus())}}async function Ke(e){const{functionName:t,result:n}=e;let r;switch(t){case"searchProducts":n.action==="delegateToFrontend"&&(r=await Ge(n.keywords));break;case"getCartSummary":n.action==="delegateToFrontend"&&(r=await We());break;case"trackOrderStatus":if(n.action==="redirectToVerifyPage")r=await Qe();else{const a=`\`\`\`json
${JSON.stringify(n,null,2)}
\`\`\``;u(`Voici le résultat de l'outil ${t}:
${a}`,"stacy"),_.push({role:"model",parts:[{text:`Résultat de l'outil: ${JSON.stringify(n)}`}]})}break;case"getStoreContactInfo":case"subscribeToNewsletter":const o=`\`\`\`json
${JSON.stringify(n,null,2)}
\`\`\``;u(`Voici le résultat de l'outil ${t}:
${o}`,"stacy"),_.push({role:"model",parts:[{text:`Résultat de l'outil: ${JSON.stringify(n)}`}]});break;default:console.warn(`[Stacy] Outil ou action non géré(e): ${t}`);return}r&&await pe(r,!0)}async function Ge(e){u(`Je cherche des produits correspondant à "${e}"...`,"stacy");const t=await ze(),n=e.toLowerCase().split(" ").filter(o=>o),r=t.filter(o=>n.every(a=>o.title.toLowerCase().includes(a)));if(r.length>0){const o=r.slice(0,3).map(a=>`<li><a href="${a.url}" class="zflex-link">${w(a.title)}</a> - ${a.price.amount} ${a.price.currency}</li>`).join("");return u(`J'ai trouvé ${r.length} produit(s). Voici les plus pertinents :
<ul>${o}</ul>`,"stacy"),`[Action Système] J'ai montré à l'utilisateur ${r.length} produits pour la recherche "${e}".`}else return u(`Désolé, je n'ai trouvé aucun produit pour "${e}".`,"stacy"),`[Action Système] Je n'ai trouvé aucun produit pour la recherche "${e}".`}async function We(){const e=I();if(e.length===0)return u("Votre panier est actuellement vide.","stacy"),"[Action Système] L'utilisateur a demandé son panier, il était vide.";const t=e.reduce((a,s)=>a+s.quantity,0),n=e.reduce((a,s)=>a+s.price.amount*s.quantity,0),r=e[0].price.currency,o=`Votre panier contient ${t} article(s) pour un total de ${n.toFixed(2)} ${r}.`;return u(o,"stacy"),`[Action Système] J'ai résumé le panier de l'utilisateur : ${t} articles, total ${n.toFixed(2)} ${r}.`}async function Qe(){return G?(u("Je vous redirige vers la page de vérification...","stacy"),G.navigateTo("/verify/"),W(),"[Action Système] J'ai redirigé l'utilisateur vers la page /verify/."):(u("Vous pouvez suivre votre commande sur notre page de vérification.","stacy"),"[Action Système] J'ai informé l'utilisateur d'aller sur la page de vérification (routeur non disponible).")}function W(){const e=document.querySelector("[data-stacy-window]"),t=document.querySelector("[data-stacy-fab-button]");if(!(!e||!t)&&(E=!E,e.classList.toggle("is-open",E),t.setAttribute("aria-expanded",String(E)),E)){const n=document.querySelector("[data-stacy-input]");n&&setTimeout(()=>n.focus(),50)}}function Ye(){const e=document.querySelector("[data-stacy-fab-button]");e&&e.addEventListener("click",W);const t=document.querySelector("[data-stacy-form]");if(t){t.addEventListener("submit",Ue);const n=t.querySelector("[data-stacy-input]");n&&n.addEventListener("keydown",r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),t.requestSubmit())})}document.addEventListener("keydown",n=>{n.key==="Escape"&&E&&W()})}function Xe(e){document.querySelector("[data-stacy-fab]")&&(G=e,Ye(),Je(),N()&&snapshotPage(N()),console.log("[Stacy] Module V6.2 (Agent Exécuteur Corrigé) initialisé."))}function A(){const e=document.getElementById("search-modal"),t=document.getElementById("search-input");if(!e||!t)return;!e.classList.contains("hidden")?(e.classList.add("opacity-0"),setTimeout(()=>e.classList.add("hidden"),300)):(e.classList.remove("hidden"),requestAnimationFrame(()=>e.classList.remove("opacity-0")),t.focus())}function Ze(e){const t=document.getElementById("search-results");if(t){if(e.length===0){t.innerHTML='<p class="text-center p-4" style="color: var(--text-muted-color);">Aucun résultat trouvé. Veuillez consulter notre assistante Stacy pour plus de recommandations.</p>';return}t.innerHTML=e.map(n=>`
    <a href="${n.url}" class="flex items-center p-3 hover:bg-gray-100/50 transition-colors zflex-link border-b" style="border-color: var(--card-border-color);">
      <img src="${n.coverImage}" alt="${n.title}" class="w-12 h-12 object-cover rounded-md mr-4 flex-shrink-0">
      <div class="flex-grow">
        <h4 class="font-semibold" style="color: var(--text-color);">${n.title}</h4>
        <p class="text-sm font-bold" style="color: var(--primary-color);">${n.price.amount.toFixed(2)} ${n.price.currency}</p>
      </div>
    </a>
  `).join("")}}async function et(){const e=document.getElementById("search-toggle-btn"),t=document.getElementById("search-modal"),n=document.getElementById("search-modal-overlay"),r=document.getElementById("search-input"),o=document.getElementById("search-results");if(!e||!t||!r||!n||!o)return;const a=await z();e.addEventListener("click",A),n.addEventListener("click",A),r.addEventListener("input",()=>{const s=r.value.trim().toLowerCase();if(s.length<2){o.innerHTML='<p class="text-center p-4" style="color: var(--text-muted-color);">Tapez au moins 2 caractères pour rechercher.</p>';return}const i=a.filter(l=>l.title.toLowerCase().includes(s)).slice(0,5);Ze(i)}),document.addEventListener("keydown",s=>{s.key==="Escape"&&!t.classList.contains("hidden")&&A()}),o.addEventListener("click",s=>{s.target.closest("a")&&A()})}function tt(){const e=document.getElementById("site-header");if(!e||e.dataset.variant!=="transparent")return;const t=()=>{window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled")};window.addEventListener("scroll",t,{passive:!0}),t()}function nt(){const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-menu");!e||!t||e.addEventListener("click",()=>{t.classList.toggle("hidden")})}function rt(){const e=document.getElementById("settings-toggle-btn"),t=document.getElementById("settings-menu");!e||!t||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.toggle("hidden")}),document.addEventListener("click",()=>{t.classList.add("hidden")}))}function ot(){tt(),nt(),rt(),console.log("[GlobalUI] Module initialisé.")}const ge="zflex_analytics_queue_v1",at=1e4,st=50,it=3,ct=150;let f=[],J=!1,U=null,ie=0;function lt(){try{const e=localStorage.getItem(ge);e&&(f=JSON.parse(e))}catch(e){console.warn("[Analytics] Load queue failed.",e),f=[]}}function Z(){try{localStorage.setItem(ge,JSON.stringify(f))}catch(e){console.warn("[Analytics] Persist queue failed.",e)}}function dt(e,t={}){var r;const n=ee()||{};return{type:e,payload:t,storeId:n.storeId||null,context:{pageType:((r=document.querySelector("main"))==null?void 0:r.dataset.pageType)||null,title:document.title,url:window.location.href},ts:new Date().toISOString(),version:n.zflex_version||null}}function y(e,t={}){if(!e)return;const n=dt(e,t);f.push(n),Z(),console.log(`[Analytics] Event Queued: ${e}`,t)}async function ye(e,t=1){if(!e||e.length===0)return{ok:!0};try{const n=e[0].storeId;return n?await Me(n,e):{ok:!1,error:"Missing storeId"}}catch(n){return t<it?(await new Promise(r=>setTimeout(r,1e3*t)),ye(e,t+1)):{ok:!1,error:String(n)}}}async function Q(){if(!(J||f.length===0)){J=!0;try{const e=f.slice(0,st),t=await ye(e);t&&t.ok&&(f.splice(0,e.length),Z())}finally{J=!1}}}function ut(){U&&clearInterval(U),U=setInterval(Q,at),document.addEventListener("visibilitychange",()=>document.visibilityState==="hidden"&&Q()),window.addEventListener("beforeunload",()=>{var e;if(f.length!==0)try{const t=ee(),n=(e=t.apiEndpoints)==null?void 0:e.trackEvent;navigator.sendBeacon&&n&&(navigator.sendBeacon(n,JSON.stringify({storeId:t.storeId,events:f})),f=[],Z())}catch(t){console.warn("[Analytics] Beacon failed.",t)}})}function mt(){const e={"stacy:message_sent":t=>y("send_stacy_message",{length:t.message.length}),"cart:item_added":t=>y("add_to_cart",t.item),"cart:item_removed":t=>y("remove_from_cart",t.item),"cart:cleared":()=>y("clear_cart"),"checkout:purchase_success":t=>y("purchase",t.order)};for(const[t,n]of Object.entries(e))k.addEventListener(t,r=>n(r.detail))}function ft(e){const t=e.getAttribute("data-analytics-type")||"",n=e.getAttribute("data-analytics-payload");let r={};if(n)try{r=JSON.parse(n)}catch(o){console.warn("[Analytics] Échec parsing payload, attribut brut:",{payloadAttr:n,error:o})}return{type:t,payload:r}}function pt(){document.addEventListener("click",e=>{const t=Date.now();if(t-ie<ct){e.stopImmediatePropagation();return}ie=t;const n=e.target.closest("[data-analytics-type]");if(!n)return;const{type:r,payload:o}=ft(n);r&&y(r,o)},!0)}function gt(){lt(),ut(),pt(),mt(),console.log("[Analytics] Module V3.2 (The Final Cut) initialisé.")}function Y({path:e,title:t,extra:n={}}={}){y("pageview",{url:e||window.location.href,title:t||document.title,...n})}function yt(e,t={}){y(e,t)}window.zflexAnalytics={track:yt,trackPageview:Y,flush:Q,getQueue:()=>f};const ce={isScrolling:!1,init(){this.bindEventListeners(),window.addEventListener("popstate",()=>this.handleLocationChange());try{Y()}catch(e){console.warn("[Router] Le tracking de la page initiale a échoué:",e)}console.log("[Router] Initialisé en mode GATEKEEPER.")},handleLinkClick(e){if(this.isScrolling)return;const t=e.target.closest("a.zflex-link");if(!t||t.target==="_blank")return;const n=new URL(t.href);if(n.hash&&n.pathname===window.location.pathname){e.preventDefault();const r=document.querySelector(n.hash);r&&r.scrollIntoView({behavior:"smooth",block:"start"});return}n.origin===window.location.origin&&(e.preventDefault(),this.navigateTo(n.pathname))},bindEventListeners(){document.body.addEventListener("touchstart",()=>{this.isScrolling=!1},{passive:!0}),document.body.addEventListener("touchmove",()=>{this.isScrolling=!0},{passive:!0}),document.body.addEventListener("click",this.handleLinkClick.bind(this)),document.body.addEventListener("touchend",this.handleLinkClick.bind(this))},navigateTo(e){e!==window.location.pathname&&(history.pushState({path:e},"",e),this.handleLocationChange())},async handleLocationChange(){const e=window.location.pathname;console.log(`[Router] Navigation détectée vers : ${e}`);const t=e==="/"||e===""?"/content/home.html":`/content${e.replace(/\/$/,"")}.html`,n=document.getElementById("app-content"),r=document.getElementById("router-loader");if(!n){console.error("ERREUR CRITIQUE: Conteneur #app-content introuvable.");return}r&&r.classList.remove("hidden"),n.style.opacity="0.5",n.style.transition="opacity 0.3s ease-in-out";try{const o=await fetch(t);if(!o.ok){if(o.status===404){const i=await(await fetch("/content/404.html")).text();this.updatePageContent(i,"404 - Page non trouvée");return}throw new Error(`Erreur serveur: ${o.statusText}`)}const a=await o.text();this.updatePageContent(a)}catch(o){console.error("Erreur de routage critique:",o),n.innerHTML=`
        <div class="text-center py-20">
          <h1 class="text-2xl font-bold">Erreur de chargement</h1>
          <p class="text-gray-600 mt-2">${o.message}</p>
          <button onclick="window.location.reload()" class="mt-4 bg-primary text-white font-bold py-2 px-4 rounded">Recharger la page</button>
        </div>
      `}finally{r&&r.classList.add("hidden"),document.body.contains(n)&&(n.style.opacity="1"),window.scrollTo(0,0)}},updatePageContent(e,t=null){const n=document.getElementById("app-content"),r=document.getElementById("zflex-data"),s=new DOMParser().parseFromString(e,"text/html").querySelector("main");if(s&&r){const i=s.querySelector(".zflex-fragment-data");i&&(r.textContent=i.textContent,i.remove()),document.title=t||s.dataset.pageTitle||document.title,n.innerHTML="",n.appendChild(s),ve();try{Y()}catch(l){console.warn("[Router] Le tracking de la nouvelle page a échoué:",l)}}else console.error("Erreur critique: <main> ou #zflex-data manquant.")}};function ht(){try{const e=document.getElementById("zflex-data");return e?JSON.parse(e.textContent||"{}"):{}}catch(e){return console.error("[Stacy] getPageData parse error",e),{}}}function vt(){const e=document.getElementById("newsletter-form"),n=ht().storeId;if(!e){console.warn("Newsletter form not found. Skipping initialization.");return}e.addEventListener("submit",async r=>{r.preventDefault();const o=e.querySelector('input[type="email"]');if(!o){console.error("Email input not found in newsletter form."),v("Erreur","Impossible de trouver le champ email.","error");return}const a=o.value.trim();if(!a){v("Attention","Veuillez entrer une adresse email valide.","warning");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)){v("Attention","Le format de l'adresse email est invalide.","warning");return}const s=e.querySelector('button[type="submit"]');s&&(s.disabled=!0,s.textContent="Envoi..."),o.disabled=!0;try{const i=await De(a,n);if(i&&i.success)v("Merci !",`Vous êtes maintenant inscrit avec l'adresse : ${a}`,"success"),e.reset();else{const l=(i==null?void 0:i.message)||"Une erreur est survenue lors de l'inscription. Veuillez réessayer.";v("Erreur",l,"error")}}catch(i){console.error("Newsletter subscription error:",i),v("Erreur","Une erreur inattendue est survenue. Veuillez réessayer plus tard.","error")}finally{s&&(s.disabled=!1,s.textContent="S'abonner"),o.disabled=!1}})}let x;function wt(){const e=document.getElementById("install-app-btn");e&&(console.log("[PWA] L'application est maintenant installable."),e.disabled=!1,e.classList.remove("opacity-50","cursor-not-allowed"),e.addEventListener("click",Et,{once:!0}))}function he(){const e=document.getElementById("install-app-btn"),t=document.getElementById("app-installed-message");e&&t&&(e.classList.add("hidden"),t.classList.remove("hidden"))}async function Et(){if(!x)return;x.prompt();const{outcome:e}=await x.userChoice;e==="accepted"?(console.log("[PWA] L'utilisateur a accepté l'installation."),he()):console.log("[PWA] L'utilisateur a refusé l'installation."),x=null}function St(){window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone?(console.log("[PWA] Détecté comme une application installée."),he()):window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),x=e,wt()}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(()=>console.log("[PWA] Service Worker OK.")).catch(e=>console.error("[PWA] Service Worker KO:",e))}let le=!1,L=null;function ee(){const e=document.getElementById("zflex-data");if(!e||!e.textContent)return console.warn("[App] Tunnel de data #zflex-data est vide ou introuvable."),{};try{return JSON.parse(e.textContent)}catch(t){return console.error("[App] Erreur de parsing du tunnel de data #zflex-data:",t),{}}}const de={"product-detail":async()=>{const{initProductGallery:e}=await C(async()=>{const{initProductGallery:t}=await import("../assets/product-gallery-CW4kno63.js");return{initProductGallery:t}},[]);return Be(),e(),{destroy:()=>console.log("[App] Cleanup: product-detail")}},"category-view":async()=>{const{initFilterSort:e}=await C(async()=>{const{initFilterSort:t}=await Promise.resolve().then(()=>Ce);return{initFilterSort:t}},void 0);return e(),{destroy:()=>console.log("[App] Cleanup: category-view")}},cart:async()=>(Pe(),{destroy:()=>console.log("[App] Cleanup: cart")}),checkout:async()=>{const{initCheckout:e}=await C(async()=>{const{initCheckout:t}=await import("../assets/checkout-D8mBWSwY.js");return{initCheckout:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: checkout")}},"order-success":async()=>{const{initOrderSuccess:e}=await C(async()=>{const{initOrderSuccess:t}=await import("../assets/order-success-DaRlGU8P.js");return{initOrderSuccess:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: order-success")}},verify:async()=>{const{initVerifyPage:e}=await C(async()=>{const{initVerifyPage:t}=await import("../assets/verify-Bve0uL8W.js");return{initVerifyPage:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: verify")}},"not-found":async()=>({destroy:()=>console.log("[App] Cleanup: not-found")}),unknown:async()=>({destroy:()=>{}})};async function ve(){var r;L&&typeof L.destroy=="function"&&L.destroy();const e=document.querySelector("#app-content main"),t=((r=e==null?void 0:e.dataset)==null?void 0:r.pageType)||"unknown";console.log(`[App] Chargement des scripts pour la page: "${t}"`);const n=de[t]||de.unknown;try{L=await n()}catch(o){console.error(`[App] Erreur lors du chargement du module pour "${t}":`,o),L=null}vt()}function bt(){console.log("[Preview] Initialisation du mode éditeur temps réel"),window.addEventListener("message",n=>{if(n.data.source==="zflex-admin")switch(console.log("[Preview] Message reçu de l'éditeur:",n.data),n.data.action){case"updateElement":e(n.data.payload);break;case"updateStyle":t(n.data.payload);break;default:console.warn("[Preview] Action non reconnue:",n.data.action)}});function e(n){const{id:r,value:o}=n,a=document.querySelector(`[data-zflex-id="${r}"]`);a?(console.log(`[Preview] Mise à jour élément ${r}:`,o),a.tagName==="IMG"?(a.src=o,a.alt=o):a.innerText=o,a.style.transition="all 0.3s ease",a.style.transform="scale(1.02)",setTimeout(()=>{a.style.transform="scale(1)"},300)):console.warn(`[Preview] Élément avec data-zflex-id="${r}" non trouvé`)}function t(n){const{property:r,value:o}=n;console.log(`[Preview] Mise à jour style ${r}:`,o),document.documentElement.style.setProperty(r,o),r.includes("color")&&(document.body.style.transition="background-color 0.3s ease, color 0.3s ease",setTimeout(()=>{document.body.style.transition=""},300))}window.parent!==window&&window.parent.postMessage({source:"zflex-preview",action:"ready",payload:{url:window.location.href}},"*")}function ue(){if(le)return;console.log("[App] Démarrage zFlex — L'Architecture Finale.");const e=new URLSearchParams(window.location.search).get("preview")==="true";e?(console.log("[App] Mode Preview activé - Désactivation des interactions utilisateur"),document.body.style.pointerEvents="none",document.body.style.cursor="not-allowed",bt()):console.log("[App] Mode normal - Initialisation des scripts interactifs");try{if(!window.firebase||!window.firebase.initializeApp)throw new Error("Le SDK Firebase (compat) n'a pas été chargé. Vérifie les scripts dans _head.njk.");const n=document.getElementById("firebase-config-data");if(!n)throw new Error("Firebase config data island not found.");const r=JSON.parse(n.textContent||"{}");if(!r.apiKey)throw new Error("Firebase apiKey is missing.");window.firebase.initializeApp(r),console.log("[Firebase] Initialisation via le scope global réussie.")}catch(n){console.error("[Firebase] ÉCHEC CRITIQUE DE L'INITIALISATION :",n);return}e||($e(),Xe(ce),ot(),et(),ke(),St(),gt(),ce.init()),ve(),le=!0;const t=["color: #00BFFF","font-size: 12px","font-family: monospace","background: #0E0E0E","padding: 4px 8px","border-radius: 4px"].join(";");console.log("%c Fearless Engine: Online. Status: Flawless. ",t),window.location.hostname==="localhost"||window.location.hostname.includes("192.168.")?(console.log("------------------"),console.log("< Happy Hacking! — Fearless >"),console.log("------------------"),console.log("        \\   ^__^"),console.log("         \\  (oo)\\_______"),console.log("            (__)\\       )/\\"),console.log("                ||----w |"),console.log("                ||     ||"),console.log(`
version: dev (local)`)):(console.log("------------------"),console.log("< Ready for Action! — Fearless >"),console.log("------------------"),console.log("        \\   ^__^"),console.log("         \\  (oo)\\_______"),console.log("            (__)\\       )/\\"),console.log("                ||----w |"),console.log("                ||     ||"),console.log(`
version: production (${new Date().toISOString().slice(0,10)})`))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ue,{once:!0}):ue();export{C as _,Tt as a,_t as b,Lt as c,Ct as d,k as e,xt as f,I as g,kt as i,ce as r,v as s};
