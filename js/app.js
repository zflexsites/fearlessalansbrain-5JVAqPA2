const Re="modulepreload",Ge=function(e){return"/"+e},Ee={},z=function(t,n,r){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));o=Promise.allSettled(n.map(m=>{if(m=Ge(m),m in Ee)return;Ee[m]=!0;const a=m.endsWith(".css"),u=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${u}`))return;const c=document.createElement("link");if(c.rel=a?"stylesheet":Re,a||(c.as="script"),c.crossOrigin="",c.href=m,l&&c.setAttribute("nonce",l),document.head.appendChild(c),a)return new Promise((f,d)=>{c.addEventListener("load",f),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${m}`)))})}))}function i(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return o.then(s=>{for(const l of s||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})};let W=[],Se=!1,ce=null;async function re(){if(Se)return W;try{const e=await fetch("/api/search-index.json");if(!e.ok)throw new Error(`Erreur réseau: ${e.statusText}`);return W=await e.json(),Se=!0,W}catch(e){return console.error("[FilterSort] Impossible de charger l'index des produits:",e),[]}}function We(e,t){const n=[...e];switch(t){case"price-asc":n.sort((r,o)=>r.price.amount-o.price.amount);break;case"price-desc":n.sort((r,o)=>o.price.amount-r.price.amount);break;case"name-asc":n.sort((r,o)=>r.title.localeCompare(o.title));break;case"name-desc":n.sort((r,o)=>o.title.localeCompare(r.title));break}return n}function Ke(e){const t=document.getElementById("product-grid");if(t){if(!ce){const n=t.querySelector(".product-card");if(!n)return;ce=n.cloneNode(!0)}if(t.innerHTML="",e.length===0){t.innerHTML='<p class="col-span-full text-center text-gray-500 py-8">Aucun produit ne correspond à votre sélection.</p>';return}e.forEach(n=>{const r=ce.cloneNode(!0),o=r.querySelector("a"),i=r.querySelector("img"),s=r.querySelector("h4"),l=r.querySelector(".product-price");o&&(o.href=n.url),i&&(i.src=n.coverImage,i.alt=n.title),s&&(s.textContent=n.title),l&&n.price&&(l.textContent=`${n.price.amount.toFixed(2)} ${n.price.currency}`),t.appendChild(r)})}}async function Qe(){if(!document.getElementById("product-controls"))return;await re();const t=JSON.parse(document.getElementById("zflex-data").textContent),n=t.category?t.category.id:null;if(!n)return;const r=W.filter(a=>a.categoryId===n),o=document.getElementById("sort-dropdown");if(!o)return;const i=document.getElementById("sort-btn"),s=document.getElementById("sort-label"),l=document.getElementById("sort-options"),m=l.querySelectorAll(".sort-option");i.addEventListener("click",a=>{a.stopPropagation(),l.classList.toggle("hidden")}),m.forEach(a=>{a.addEventListener("click",u=>{u.preventDefault();const c=a.dataset.value,f=a.textContent;s.textContent=`Trier par : ${f}`,l.classList.add("hidden");const d=We(r,c);Ke(d)})}),document.addEventListener("click",a=>{o.contains(a.target)||l.classList.add("hidden")}),console.log("[FilterSort] Module initialisé.")}const Ye=Object.freeze(Object.defineProperty({__proto__:null,fetchProductIndex:re,initFilterSort:Qe},Symbol.toStringTag,{value:"Module"})),U=window.zflexEventBus||new EventTarget;window.zflexEventBus=U;let D,ie,me,Q,K,q,Y,X,Z,ee=null,te=null;function he(){D&&(D.classList.add("hidden"),ee=null,te=null)}function Xe(e){if(typeof ee=="function")try{ee()}catch(t){console.error("[Dialog] Erreur dans onConfirm:",t)}he()}function Ze(e){if(typeof te=="function")try{te()}catch(t){console.error("[Dialog] Erreur dans onCancel:",t)}he()}function M(e,t,n={}){if(!D){alert(`${e}

${t}`),n.onConfirm&&n.onConfirm();return}Y.classList.add("hidden"),X.classList.add("hidden"),Z.classList.add("hidden"),n.variant==="success"?Y.classList.remove("hidden"):n.variant==="error"?X.classList.remove("hidden"):Z.classList.remove("hidden"),me.textContent=e,n.messageHtml?Q.innerHTML=n.messageHtml:Q.textContent=t||"",K.textContent=n.confirmText||"OK",n.cancelText?(q.classList.remove("hidden"),q.textContent=n.cancelText):q.classList.add("hidden"),ee=typeof n.onConfirm=="function"?n.onConfirm:null,te=typeof n.onCancel=="function"?n.onCancel:null,D.classList.remove("hidden")}function et(){if(D=document.getElementById("zflex-dialog"),!!D){if(ie=document.getElementById("dialog-overlay"),me=document.getElementById("dialog-title"),Q=document.getElementById("dialog-message"),K=document.getElementById("dialog-confirm-btn"),q=document.getElementById("dialog-cancel-btn"),Y=document.getElementById("dialog-icon-success"),X=document.getElementById("dialog-icon-error"),Z=document.getElementById("dialog-icon-info"),!ie||!me||!Q||!K||!Y||!X||!Z||!q){console.error("[Dialog] Un ou plusieurs éléments internes du dialog sont manquants. Vérifie les IDs."),D=null;return}ie.addEventListener("click",he),K.addEventListener("click",Xe),q.addEventListener("click",Ze),U.addEventListener("dialog:show",e=>{const t=e.detail||{},{title:n,message:r,variant:o}=t,i={variant:o,onConfirm:t.onConfirm,onCancel:t.onCancel,confirmText:t.confirmText,cancelText:t.cancelText,messageHtml:t.messageHtml};M(n,r,i)}),console.log("[Dialog] Module initialisé et prêt (callbacks & HTML).")}}const Be="zflex_cart";function H(){return JSON.parse(localStorage.getItem(Be))||[]}function oe(e){localStorage.setItem(Be,JSON.stringify(e)),window.dispatchEvent(new CustomEvent("cartUpdated"))}function tt(e,t=1){const n=H(),r=n.find(o=>o.id===e.id);r?r.quantity+=t:n.push({id:e.id,title:e.title,price:e.price,coverImage:e.coverImage,url:e.url,quantity:t}),oe(n)}function nt(e,t){let n=H();const r=n.find(o=>o.id===e);r&&(t>0?r.quantity=t:n=n.filter(o=>o.id!==e),oe(n))}function rt(e){const t=H().filter(n=>n.id!==e);oe(t)}function Wt(){oe([])}function Ce(){const e=document.getElementById("cart-count");if(!e)return;const n=H().reduce((r,o)=>r+o.quantity,0);e.textContent=n,e.style.display=n>0?"flex":"none",n>0&&(e.classList.add("updated"),setTimeout(()=>{e.classList.remove("updated")},300))}function Me(){if(!document.querySelector('[data-page-type="cart"]'))return;const t=document.getElementById("cart-items-list"),n=document.getElementById("cart-subtotal"),r=document.getElementById("cart-total"),o=document.getElementById("cart-empty-state"),i=document.getElementById("cart-content");if(!t||!n||!r||!o||!i){console.error("[Cart] Erreur critique: DOM manquant dans cart.njk.");return}const s=H(),l=document.getElementById("cart-item-template");if(!l){console.error("[Cart] Erreur critique: le template #cart-item-template est manquant.");return}if(s.length===0){o.classList.remove("hidden"),i.classList.add("hidden");return}o.classList.add("hidden"),i.classList.remove("hidden"),t.innerHTML="";let m={};s.forEach(a=>{var g,h;const u=Number(((g=a.price)==null?void 0:g.amount)||0),c=((h=a.price)==null?void 0:h.currency)||"EUR",f=Number(a.quantity||1),d=l.content.cloneNode(!0);d.querySelector('[data-template-field="image"]').src=a.coverImage||"",d.querySelector('[data-template-field="title"]').textContent=a.title||"Produit sans nom",d.querySelector('[data-template-field="url"]').href=a.url||"#",d.querySelector('[data-template-field="price"]').textContent=`${u.toFixed(2)} ${c}`;const p=d.querySelector('[data-template-field="quantity"]');p.value=f,d.querySelector('[data-template-field="total"]').textContent=`${(u*f).toFixed(2)} ${c}`,p.addEventListener("change",()=>nt(a.id,parseInt(p.value,10))),d.querySelector('[data-template-field="remove-btn"]').addEventListener("click",()=>rt(a.id)),t.appendChild(d),m[c]||(m[c]=0),m[c]+=u*f}),n.innerHTML="",r.innerHTML="",Object.entries(m).forEach(([a,u])=>{const c=`${Number(u).toFixed(2)} ${a}`;n.innerHTML+=`<div>${c}</div>`,r.innerHTML+=`<div>${c}</div>`})}function ot(){document.querySelector('[data-page-type="cart"]')&&(console.log("[Cart] Initialisation de la page panier..."),Me())}async function at(){document.querySelectorAll("#add-to-cart-btn").forEach(e=>{e.dataset.listenerAttached||(e.addEventListener("click",async()=>{e.disabled=!0;try{const t=document.getElementById("zflex-data");if(!t)throw new Error("Erreur critique: Tunnel de data #zflex-data manquant.");const n=JSON.parse(t.textContent);if(!(n!=null&&n.product))throw new Error("Données du produit non trouvées dans le tunnel de data.");const o=(await re()).find(i=>i.id===n.product.id);if(o)tt(o),U.dispatchEvent(new CustomEvent("dialog:show",{detail:{title:"Ajouté au panier !",message:`${o.title.trim()} a bien été ajouté.`,variant:"success"}}));else throw new Error("Produit introuvable dans l'index de recherche.")}catch(t){console.error("Erreur lors de l'ajout au panier:",t),U.dispatchEvent(new CustomEvent("dialog:show",{detail:{title:"Erreur",message:t.message||"Impossible d'ajouter ce produit au panier.",variant:"error"}}))}finally{e.disabled=!1}}),e.dataset.listenerAttached="true")})}function st(){Ce(),window.addEventListener("cartUpdated",()=>{Ce(),Me()}),console.log("[Cart] Module global initialisé.")}async function L(e,t){var o;const r=(o=ae().apiEndpoints)==null?void 0:o[e];if(!r)throw new Error(`Endpoint API pour "${e}" non trouvé. Vérifiez la configuration du builder.`);try{const i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),s=await i.json();if(!i.ok){const l=s.error||`Erreur ${i.status}`;throw new Error(l)}return s}catch(i){throw console.error(`[API] Erreur pour "${e}":`,i),new Error("La communication avec nos services a échoué. Veuillez réessayer.")}}function De(e,t){return L("createConv",{storeId:e,context:t})}function ct(e,t,n,r){return L("stacy",{storeId:e,convId:t,message:n,contextDelta:r})}function xe(e,t,n){return L("continueConv",{storeId:e,convId:t,functionCallResult:n})}function Kt(e,t){return L("createOrder",{...e,storeId:t})}function Qt(e,t){return L("getOrderDetails",{orderId:e,storeId:t})}function Yt(e,t,n,r,o){return L("initiatePayment",{orderId:e,storeId:t,paymentMethod:n,paymentPhone:r,transactionReference:o})}function Xt(e,t){return L("getOrderStatusApi",{orderId:e,storeId:t})}function Zt(e,t){return L("getProspectInfo",{storeId:e,prospectId:t})}function it(e,t){return L("subscribeToNewsletter",{email:e,storeId:t})}function lt(e,t){return L("trackEvent",{storeId:e,events:t})}let P=!1,x=[],J=!1,R=null,pe=null;const dt=24*60*60*1e3,ne=e=>`stacy_conv_${e}`,ut=new Set(["searchProducts","getCartSummary","redirectToVerifyPage"]);function N(){try{const e=document.getElementById("zflex-data");return e?JSON.parse(e.textContent||"{}"):{}}catch(e){return console.error("[Stacy] Erreur de parsing des données de la page",e),{}}}async function mt(){if(R)return R;try{const e=await fetch("/api/search-index.json");if(!e.ok)throw new Error(`Réponse réseau non OK: ${e.statusText}`);return R=await e.json(),R}catch(e){return console.error("[Stacy] Impossible de charger l'index de recherche:",e),[]}}function A(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Oe(e){try{if(/^(https?:|mailto:)/i.test(String(e).trim()))return String(e).trim()}catch{}return"#"}function we(e){let t=A(e);return t=t.replace(/```([\s\S]*?)```/g,(n,r)=>`<pre class="stacy-code"><code>${A(r)}</code></pre>`),t=t.replace(/`([^`]+)`/g,(n,r)=>`<code class="stacy-inline-code">${A(r)}</code>`),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(n,r,o)=>`<a href="${Oe(o)}" target="_blank" rel="noopener noreferrer" class="zflex-link">${A(r)}</a>`),t=t.replace(/\*\*([^*]+)\*\*/g,(n,r)=>`<strong>${A(r)}</strong>`),t=t.replace(/\*([^*]+)\*/g,(n,r)=>`<em>${A(r)}</em>`),t=t.replace(/\r?\n/g,"<br>"),t}function ve(e){try{let i=function(s){const l=Array.from(s.childNodes);for(const m of l)if(m.nodeType===Node.ELEMENT_NODE){const a=m;if(o.has(a.tagName)){if(a.tagName==="A"){const u=a.getAttribute("href")||"";/^(https?:|mailto:)/i.test(u.trim())?(a.setAttribute("target","_blank"),a.setAttribute("rel","noopener noreferrer")):a.removeAttribute("href")}else{const u=Array.from(a.attributes);for(const c of u)a.removeAttribute(c.name)}i(a)}else{const u=document.createDocumentFragment();for(;a.firstChild;)u.appendChild(a.firstChild);s.replaceChild(u,a),i(s);continue}}else m.nodeType===Node.TEXT_NODE||s.removeChild(m)};const r=new DOMParser().parseFromString(`<div>${e}</div>`,"text/html").body.firstChild,o=new Set(["A","UL","OL","LI","STRONG","EM","CODE","PRE","BR","P"]);return i(r),r.innerHTML}catch(t){return console.warn("[Stacy] sanitizeHtml failed, falling back to escaped text",t),A(e)}}function B(e,t,n={rawHtml:!1}){const r=document.querySelector("[data-stacy-messages]");if(!r)return;const o=document.createElement("div");o.className="flex flex-col p-1 my-1 max-w-[85%] text-sm break-words";const i=document.createElement("div");i.className="p-2 rounded-lg";const s=document.createElement("div");s.className="text-xs mb-1 truncate";const l=typeof e=="string"?e:JSON.stringify(e??"");if(t==="user")o.style.alignSelf="flex-end",i.classList.add("bg-primary/20","self-end"),s.textContent="Vous",s.style.textAlign="right",i.textContent=l,o.appendChild(s),o.appendChild(i);else{let m=function(d,p=1){const y=d.replace("#","").trim(),g=y.length===3?y.split("").map(b=>b+b).join(""):y,h=parseInt(g.substring(0,2),16),v=parseInt(g.substring(2,4),16),w=parseInt(g.substring(4,6),16);return`rgba(${h}, ${v}, ${w}, ${p})`};o.style.alignSelf="flex-start",s.textContent="Stacy",s.style.color="var(--text-muted-color)",i.classList.add("self-start");const u=(getComputedStyle(document.documentElement).getPropertyValue("--accent-color")||"").trim()||"#3B82F6",c=m(u,.12),f=m(u,.18);i.style.background=c,i.style.border=`1px solid ${f}`,i.style.color="var(--text-color)",n.rawHtml?i.innerHTML=ve(l):i.innerHTML=we(l),o.appendChild(s),o.appendChild(i)}r.appendChild(o),r.scrollTop=r.scrollHeight}function pt(){const e=document.querySelector("[data-stacy-messages]");if(!e)return null;const t=document.createElement("div");return t.className="p-2 my-1 rounded-lg max-w-[60%] self-start text-sm break-words stacy-typing",t.innerHTML='<div class="typing-indicator"><span></span><span></span><span></span></div>',e.appendChild(t),e.scrollTop=e.scrollHeight,t}function ft(e,t={rawHtml:!1}){const n=document.querySelector("[data-stacy-messages]");if(!n)return null;const r=document.createElement("div");r.className="flex flex-col p-1 my-1 max-w-[85%] text-sm break-words model-message-wrapper";const o=document.createElement("div");o.className="text-xs mb-1 truncate",o.textContent="Stacy",o.style.color="var(--muted-text-color)";const i=document.createElement("div");i.className="p-2 rounded-lg self-start model-message-bubble";const s=typeof e=="string"?e:JSON.stringify(e??"");t.rawHtml?i.innerHTML=ve(s):i.innerHTML=we(s);const l=document.createElement("div");return l.className="stacy-partial-loader",l.style.marginTop="6px",l.innerHTML='<div class="typing-indicator"><span></span><span></span><span></span></div>',l.style.display="none",r.appendChild(o),r.appendChild(i),r.appendChild(l),n.appendChild(r),n.scrollTop=n.scrollHeight,{wrapper:r,bubble:i,loader:l}}function Ie(e){!e||!e.loader||(e.loader.style.display="",e.wrapper.scrollIntoView({behavior:"smooth",block:"end"}))}function $(e){!e||!e.loader||(e.loader.style.display="none")}function T(e,t,n={rawHtml:!1}){!e||!e.bubble||(n.rawHtml?e.bubble.innerHTML=ve(t):e.bubble.innerHTML=we(t),$(e))}async function Le(e,t=12e3){let n;return Promise.race([e,new Promise((r,o)=>n=setTimeout(()=>o(new Error("timeout")),t))]).finally(()=>clearTimeout(n))}async function le(e){const t=ne(e);try{const n=localStorage.getItem(t);if(n){const o=JSON.parse(n);if(Date.now()-(o.createdAt||0)<=dt)return o.convId}const r=await De(e);if(!(r!=null&&r.convId))throw new Error("createConversation n'a pas retourné de convId");return localStorage.setItem(t,JSON.stringify({convId:r.convId,createdAt:Date.now()})),r.convId}catch(n){throw console.error("[Stacy] Erreur getOrCreateConvId",n),n}}async function yt(e){try{localStorage.removeItem(ne(e));const t=document.querySelector("[data-stacy-messages]");t&&(t.innerHTML=""),x=[],J=!1;const n=await De(e);if(n!=null&&n.convId){localStorage.setItem(ne(e),JSON.stringify({convId:n.convId,createdAt:Date.now()}));const r=n.greeting||"Salut ! Je suis Stacy. Comment puis-je vous aider ?";B(r,"stacy"),x.push({role:"model",parts:[{text:r}]}),J=!0}else{const r="Salut ! Je suis Stacy. Comment puis-je vous aider ?";B(r,"stacy"),x.push({role:"model",parts:[{text:r}]}),J=!0}}catch(t){console.error("[Stacy] resetConversation error",t),B("Impossible de réinitialiser la conversation.","stacy")}}function gt(){if(J)return;const n=`Salut ! Je suis Stacy, l'assistante de ${N().storeName||"la boutique"}. Comment puis-je vous aider ?`;B(n,"stacy"),x.push({role:"model",parts:[{text:n}]}),J=!0}async function ht(e){e.preventDefault();const n=e.target.querySelector("[data-stacy-input]");if(!n)return;const r=n.value.trim();r&&(B(r,"user"),x.push({role:"user",parts:[{text:r}]}),n.value="",await wt(r))}async function wt(e,t=!1){var o;const n=document.querySelector("[data-stacy-input]");n&&(n.disabled=!0);const r=pt();try{const s=N().storeId;if(!s)throw new Error("storeId introuvable");const l=await le(s),m=await ct(s,l,e);if(r&&r.remove(),m.newConvId&&(console.log(`[Stacy] Conversation synchronisée. Nouvel ID : ${m.newConvId}`),localStorage.setItem(ne(s),JSON.stringify({convId:m.newConvId,createdAt:Date.now()}))),m.functionCall){const u=m.answer??`Action requise: ${m.functionCall.name}`,c=ft(u,{rawHtml:!1});if(x.push({role:"model",parts:[{text:u}]}),Ie(c),m.needsUserInput){$(c),T(c,u+" (J'ai besoin d'une information supplémentaire.)",{rawHtml:!1});const f=c.wrapper,d=document.createElement("input");d.type="text",d.placeholder="Entrez le numéro de commande...",d.className="stacy-inline-input";const p=document.createElement("button");p.textContent="Envoyer",p.className="stacy-inline-btn";const y=document.createElement("div");y.style.marginTop="8px",y.appendChild(d),y.appendChild(p),f.appendChild(y),d.focus(),p.addEventListener("click",async()=>{const g=d.value.trim();if(g){y.remove(),Ie(c);try{const v=N().storeId,w=await le(v),b=await xe(v,w,{name:m.functionCall.name,result:{orderId:g}}),C=(b==null?void 0:b.answer)??"Désolé, erreur lors de la finalisation.";T(c,C,{rawHtml:!1}),x.push({role:"model",parts:[{text:C}]})}catch{$(c),T(c,"Erreur lors de l'envoi de l'information. Réessaie.",{rawHtml:!1})}}}),d.addEventListener("keydown",g=>{g.key==="Enter"&&p.click()});return}if(ut.has(m.functionCall.name))try{const f=await Le(vt(m.functionCall),12e3),d=f.result??f,p=(d==null?void 0:d.displayHtml)??null,y=(d==null?void 0:d.displayText)??(typeof d=="string"?d:JSON.stringify(d));p?T(c,p,{rawHtml:!0}):T(c,y,{rawHtml:!1}),x.push({role:"model",parts:[{text:y}]});const h=N().storeId,v=await le(h),w=await Le(xe(h,v,{name:m.functionCall.name,result:d}),2e4),b=(w==null?void 0:w.answer)??"Désolé, erreur lors de la finalisation.";T(c,b,{rawHtml:!1}),x.push({role:"model",parts:[{text:b}]});return}catch{$(c),T(c,"Impossible d'exécuter l'action côté client.",{rawHtml:!1});return}if(m.answer){$(c),T(c,m.answer,{rawHtml:!1}),x.push({role:"model",parts:[{text:m.answer}]});return}$(c),T(c,"Action en attente...",{rawHtml:!1});return}const a=(m==null?void 0:m.answer)??"Désolé, une erreur est survenue.";B(a,"stacy"),x.push({role:"model",parts:[{text:a}]}),(o=m.functionResult)!=null&&o.success&&await bt(m.functionResult)}catch(i){r&&r.remove(),console.error("[Stacy] Erreur processStacyRequest",i),B("Oups, quelque chose s'est mal passé. Veuillez réessayer.","stacy")}finally{n&&(n.disabled=!1,P&&n.focus())}}async function vt(e){const t=e.name||e.functionName||e.fn,n=e.args||e.arguments||e.params||{};switch(t){case"searchProducts":{const r=String(n.keywords||n.q||""),o=await $e(r);return{success:!!o.success,action:"searchProducts",result:o}}case"getCartSummary":{const r=await qe();return{success:!!r.success,action:"getCartSummary",result:r}}case"redirectToVerifyPage":{const r=await Et();return{success:!!r.success,action:"redirectToVerifyPage",result:r}}case"getStoreContactInfo":{const r=N(),o=r.storeContact||r.contact||null;return o?{success:!0,action:"getStoreContactInfo",result:{contact:o,displayText:`Contact : ${JSON.stringify(o)}`}}:{success:!1,action:"getStoreContactInfo",result:{displayText:"Je n'ai pas les infos de contact côté client."}}}case"subscribeToNewsletter":{const r=n.email||null;return r?{success:!0,action:"subscribeToNewsletter",result:{email:r,displayText:`Merci — je vais inscrire ${r} à la newsletter (action simulée).`}}:{success:!1,action:"subscribeToNewsletter",result:{displayText:"Aucun email fourni pour l'inscription.",reason:"no-email"}}}case"trackOrderStatus":{const r=n.orderId||null;return r?{success:!0,action:"trackOrderStatus",result:{orderId:r,displayText:`Je vérifie le statut de la commande ${r}... (simulé)`}}:{success:!1,action:"trackOrderStatus",result:{displayText:"Je n'ai pas de numéro de commande côté client.",reason:"no-orderId"}}}default:return console.warn(`[Stacy] functionCall non géré côté client: ${t}`),{success:!1,action:String(t),result:{displayText:`Action demandée inconnue côté client: ${String(t)}`,reason:"unknown"}}}}async function bt(e){const t=(e==null?void 0:e.functionName)||(e==null?void 0:e.name)||(e==null?void 0:e.toolName)||e&&e.result&&e.result.action&&"unknown",n=(e==null?void 0:e.result)??e;if(t&&(n==null?void 0:n.action)==="delegateToFrontend")switch(t){case"searchProducts":await $e(n.keywords||"");break;case"getCartSummary":await qe();break;default:console.warn("[Stacy] legacy delegate action not handled:",t)}}async function $e(e){const t=await mt(),n=String(e||"").toLowerCase().split(" ").filter(o=>o),r=t.filter(o=>n.every(i=>o.title.toLowerCase().includes(i)));if(r.length>0){const o=r.slice(0,5).map(s=>`<li><a href="${Oe(s.url)}" class="zflex-link">${A(s.title)}</a> - ${s.price.amount} ${s.price.currency}</li>`).join("");return{success:!0,displayHtml:`<p>J'ai trouvé ${r.length} produit(s). Voici les plus pertinents :</p><ul>${o}</ul>`,displayText:`J'ai trouvé ${r.length} produit(s).`}}else return{success:!1,displayText:`Désolé, je n'ai trouvé aucun produit pour "${A(String(e))}".`}}async function qe(){var i,s;const e=H();if(!Array.isArray(e)||e.length===0)return{success:!1,displayText:"Votre panier est actuellement vide."};const t=e.reduce((l,m)=>l+(m.quantity||0),0),n=e.reduce((l,m)=>{var a;return l+(((a=m.price)==null?void 0:a.amount)||0)*(m.quantity||0)},0),r=((s=(i=e[0])==null?void 0:i.price)==null?void 0:s.currency)||"USD";return{success:!0,displayText:`Votre panier contient ${t} article(s) pour un total de ${n.toFixed(2)} ${r}.`}}async function Et(){if(pe)try{return pe.navigateTo("/verify/"),fe(),{success:!0,displayText:"[Action Système] Redirection vers /verify/ effectuée."}}catch(e){return console.warn("[Stacy] Router navigation failed",e),{success:!1,displayText:"[Action Système] Routeur non disponible."}}else return{success:!1,displayText:"[Action Système] Routeur non disponible."}}function fe(){const e=document.querySelector("[data-stacy-window]"),t=document.querySelector("[data-stacy-fab-button]");if(!e||!t)return;P=!P,e.classList.toggle("is-open",P),t.setAttribute("aria-expanded",String(P));const n=t.querySelector('[data-stacy-icon="chat"]'),r=t.querySelector('[data-stacy-icon="close"]');if(n&&r&&(n.style.opacity=P?"0":"1",r.style.opacity=P?"1":"0"),P){const o=document.querySelector("[data-stacy-input]");o&&setTimeout(()=>o.focus(),50)}}function St(){const e=document.querySelector("[data-stacy-fab-button]");e&&e.addEventListener("click",fe);const t=document.querySelector("[data-stacy-form]");if(t){t.addEventListener("submit",ht);const r=t.querySelector("[data-stacy-input]");r&&r.addEventListener("keydown",o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),t.requestSubmit())})}document.addEventListener("keydown",r=>{r.key==="Escape"&&P&&fe()});const n=document.querySelector("[data-stacy-delete]");n&&n.addEventListener("click",async()=>{try{const o=N().storeId;if(!o)throw new Error("storeId introuvable");await yt(o)}catch(r){console.error("[Stacy] delete conv failed",r),B("Impossible de supprimer la conversation.","stacy")}})}function Ct(e){document.querySelector("[data-stacy-fab]")&&(pe=e,St(),gt(),console.log("[Stacy] Module V7.1 (UX fixes, reset conv) initialisé."))}function G(){const e=document.getElementById("search-modal"),t=document.getElementById("search-input");if(!e||!t)return;!e.classList.contains("hidden")?(e.classList.add("opacity-0"),setTimeout(()=>e.classList.add("hidden"),300)):(e.classList.remove("hidden"),requestAnimationFrame(()=>e.classList.remove("opacity-0")),t.focus())}function xt(e){const t=document.getElementById("search-results");if(t){if(e.length===0){t.innerHTML='<p class="text-center p-4" style="color: var(--text-muted-color);">Aucun résultat trouvé. Veuillez consulter notre assistante Stacy pour plus de recommandations.</p>';return}t.innerHTML=e.map(n=>`
    <a href="${n.url}" class="flex items-center p-3 hover:bg-gray-100/50 transition-colors zflex-link border-b" style="border-color: var(--card-border-color);">
      <img src="${n.coverImage}" alt="${n.title}" class="w-12 h-12 object-cover rounded-md mr-4 flex-shrink-0">
      <div class="flex-grow">
        <h4 class="font-semibold" style="color: var(--text-color);">${n.title}</h4>
        <p class="text-sm font-bold" style="color: var(--primary-color);">${n.price.amount.toFixed(2)} ${n.price.currency}</p>
      </div>
    </a>
  `).join("")}}async function It(){const e=document.getElementById("search-toggle-btn"),t=document.getElementById("search-modal"),n=document.getElementById("search-modal-overlay"),r=document.getElementById("search-input"),o=document.getElementById("search-results");if(!e||!t||!r||!n||!o)return;const i=await re();e.addEventListener("click",G),n.addEventListener("click",G),r.addEventListener("input",()=>{const s=r.value.trim().toLowerCase();if(s.length<2){o.innerHTML='<p class="text-center p-4" style="color: var(--text-muted-color);">Tapez au moins 2 caractères pour rechercher.</p>';return}const l=i.filter(m=>m.title.toLowerCase().includes(s)).slice(0,5);xt(l)}),document.addEventListener("keydown",s=>{s.key==="Escape"&&!t.classList.contains("hidden")&&G()}),o.addEventListener("click",s=>{s.target.closest("a")&&G()})}function Lt(){const e=document.getElementById("site-header");if(!e||e.dataset.variant!=="transparent")return;const t=()=>{window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled")};window.addEventListener("scroll",t,{passive:!0}),t()}function kt(){const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-menu");!e||!t||e.addEventListener("click",()=>{t.classList.toggle("hidden")})}function Tt(){const e=document.getElementById("settings-toggle-btn"),t=document.getElementById("settings-menu");!e||!t||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.toggle("hidden")}),document.addEventListener("click",()=>{t.classList.add("hidden")}))}function Pt(){Lt(),kt(),Tt(),console.log("[GlobalUI] Module initialisé.")}const Ne="zflex_analytics_queue_v1",At=1e4,_t=50,Bt=3,Mt=150;let I=[],de=!1,ue=null,ke=0;function Dt(){try{const e=localStorage.getItem(Ne);e&&(I=JSON.parse(e))}catch(e){console.warn("[Analytics] Load queue failed.",e),I=[]}}function be(){try{localStorage.setItem(Ne,JSON.stringify(I))}catch(e){console.warn("[Analytics] Persist queue failed.",e)}}function Ot(e,t={}){var r;const n=ae()||{};return{type:e,payload:t,storeId:n.storeId||null,context:{pageType:((r=document.querySelector("main"))==null?void 0:r.dataset.pageType)||null,title:document.title,url:window.location.href},ts:new Date().toISOString(),version:n.zflex_version||null}}function _(e,t={}){if(!e)return;const n=Ot(e,t);I.push(n),be(),console.log(`[Analytics] Event Queued: ${e}`,t)}async function He(e,t=1){if(!e||e.length===0)return{ok:!0};try{const n=e[0].storeId;return n?await lt(n,e):{ok:!1,error:"Missing storeId"}}catch(n){return t<Bt?(await new Promise(r=>setTimeout(r,1e3*t)),He(e,t+1)):{ok:!1,error:String(n)}}}async function ye(){if(!(de||I.length===0)){de=!0;try{const e=I.slice(0,_t),t=await He(e);t&&t.ok&&(I.splice(0,e.length),be())}finally{de=!1}}}function $t(){ue&&clearInterval(ue),ue=setInterval(ye,At),document.addEventListener("visibilitychange",()=>document.visibilityState==="hidden"&&ye()),window.addEventListener("beforeunload",()=>{var e;if(I.length!==0)try{const t=ae(),n=(e=t.apiEndpoints)==null?void 0:e.trackEvent;navigator.sendBeacon&&n&&(navigator.sendBeacon(n,JSON.stringify({storeId:t.storeId,events:I})),I=[],be())}catch(t){console.warn("[Analytics] Beacon failed.",t)}})}function qt(){const e={"stacy:message_sent":t=>_("send_stacy_message",{length:t.message.length}),"cart:item_added":t=>_("add_to_cart",t.item),"cart:item_removed":t=>_("remove_from_cart",t.item),"cart:cleared":()=>_("clear_cart"),"checkout:purchase_success":t=>_("purchase",t.order)};for(const[t,n]of Object.entries(e))U.addEventListener(t,r=>n(r.detail))}function Nt(e){const t=e.getAttribute("data-analytics-type")||"",n=e.getAttribute("data-analytics-payload");let r={};if(n)try{r=JSON.parse(n)}catch(o){console.warn("[Analytics] Échec parsing payload, attribut brut:",{payloadAttr:n,error:o})}return{type:t,payload:r}}function Ht(){document.addEventListener("click",e=>{const t=Date.now();if(t-ke<Mt){e.stopImmediatePropagation();return}ke=t;const n=e.target.closest("[data-analytics-type]");if(!n)return;const{type:r,payload:o}=Nt(n);r&&_(r,o)},!0)}function Ft(){Dt(),$t(),Ht(),qt(),console.log("[Analytics] Module V3.2 (The Final Cut) initialisé.")}function ge({path:e,title:t,extra:n={}}={}){_("pageview",{url:e||window.location.href,title:t||document.title,...n})}function zt(e,t={}){_(e,t)}window.zflexAnalytics={track:zt,trackPageview:ge,flush:ye,getQueue:()=>I};const Te={isScrolling:!1,init(){this.bindEventListeners(),window.addEventListener("popstate",()=>this.handleLocationChange());try{ge()}catch(e){console.warn("[Router] Le tracking de la page initiale a échoué:",e)}console.log("[Router] Initialisé en mode GATEKEEPER.")},handleLinkClick(e){if(this.isScrolling)return;const t=e.target.closest("a.zflex-link");if(!t||t.target==="_blank")return;const n=new URL(t.href);if(n.hash&&n.pathname===window.location.pathname){e.preventDefault();const r=document.querySelector(n.hash);r&&r.scrollIntoView({behavior:"smooth",block:"start"});return}n.origin===window.location.origin&&(e.preventDefault(),this.navigateTo(n.pathname))},bindEventListeners(){document.body.addEventListener("touchstart",()=>{this.isScrolling=!1},{passive:!0}),document.body.addEventListener("touchmove",()=>{this.isScrolling=!0},{passive:!0}),document.body.addEventListener("click",this.handleLinkClick.bind(this)),document.body.addEventListener("touchend",this.handleLinkClick.bind(this))},navigateTo(e){e!==window.location.pathname&&(history.pushState({path:e},"",e),this.handleLocationChange())},async handleLocationChange(){const e=window.location.pathname;console.log(`[Router] Navigation détectée vers : ${e}`);const t=e==="/"||e===""?"/content/home.html":`/content${e.replace(/\/$/,"")}.html`,n=document.getElementById("app-content"),r=document.getElementById("router-loader");if(!n){console.error("ERREUR CRITIQUE: Conteneur #app-content introuvable.");return}r&&r.classList.remove("hidden"),n.style.opacity="0.5",n.style.transition="opacity 0.3s ease-in-out";try{const o=await fetch(t);if(!o.ok){if(o.status===404){const l=await(await fetch("/content/404.html")).text();this.updatePageContent(l,"404 - Page non trouvée");return}throw new Error(`Erreur serveur: ${o.statusText}`)}const i=await o.text();this.updatePageContent(i)}catch(o){console.error("Erreur de routage critique:",o),n.innerHTML=`
        <div class="text-center py-20">
          <h1 class="text-2xl font-bold">Erreur de chargement</h1>
          <p class="text-gray-600 mt-2">${o.message}</p>
          <button onclick="window.location.reload()" class="mt-4 bg-primary text-white font-bold py-2 px-4 rounded">Recharger la page</button>
        </div>
      `}finally{r&&r.classList.add("hidden"),document.body.contains(n)&&(n.style.opacity="1"),window.scrollTo(0,0)}},updatePageContent(e,t=null){const n=document.getElementById("app-content"),r=document.getElementById("zflex-data"),s=new DOMParser().parseFromString(e,"text/html").querySelector("main");if(s&&r){const l=s.querySelector(".zflex-fragment-data");l&&(r.textContent=l.textContent,l.remove()),document.title=t||s.dataset.pageTitle||document.title,n.innerHTML="",n.appendChild(s),ze();try{ge()}catch(m){console.warn("[Router] Le tracking de la nouvelle page a échoué:",m)}}else console.error("Erreur critique: <main> ou #zflex-data manquant.")}};function Vt(){try{const e=document.getElementById("zflex-data");return e?JSON.parse(e.textContent||"{}"):{}}catch(e){return console.error("[Stacy] getPageData parse error",e),{}}}function jt(){const e=document.getElementById("newsletter-form"),n=Vt().storeId;if(!e){console.warn("Newsletter form not found. Skipping initialization.");return}e.addEventListener("submit",async r=>{r.preventDefault();const o=e.querySelector('input[type="email"]');if(!o){console.error("Email input not found in newsletter form."),M("Erreur","Impossible de trouver le champ email.","error");return}const i=o.value.trim();if(!i){M("Attention","Veuillez entrer une adresse email valide.","warning");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){M("Attention","Le format de l'adresse email est invalide.","warning");return}const s=e.querySelector('button[type="submit"]');s&&(s.disabled=!0,s.textContent="Envoi..."),o.disabled=!0;try{const l=await it(i,n);if(l&&l.success)M("Merci !",`Vous êtes maintenant inscrit avec l'adresse : ${i}`,"success"),e.reset();else{const m=(l==null?void 0:l.message)||"Une erreur est survenue lors de l'inscription. Veuillez réessayer.";M("Erreur",m,"error")}}catch(l){console.error("Newsletter subscription error:",l),M("Erreur","Une erreur inattendue est survenue. Veuillez réessayer plus tard.","error")}finally{s&&(s.disabled=!1,s.textContent="S'abonner"),o.disabled=!1}})}let j;function Jt(){const e=document.getElementById("install-app-btn");e&&(console.log("[PWA] L'application est maintenant installable."),e.disabled=!1,e.classList.remove("opacity-50","cursor-not-allowed"),e.addEventListener("click",Ut,{once:!0}))}function Fe(){const e=document.getElementById("install-app-btn"),t=document.getElementById("app-installed-message");e&&t&&(e.classList.add("hidden"),t.classList.remove("hidden"))}async function Ut(){if(!j)return;j.prompt();const{outcome:e}=await j.userChoice;e==="accepted"?(console.log("[PWA] L'utilisateur a accepté l'installation."),Fe()):console.log("[PWA] L'utilisateur a refusé l'installation."),j=null}function Rt(){window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone?(console.log("[PWA] Détecté comme une application installée."),Fe()):window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),j=e,Jt()}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(()=>console.log("[PWA] Service Worker OK.")).catch(e=>console.error("[PWA] Service Worker KO:",e))}let Pe=!1,V=null;function ae(){const e=document.getElementById("zflex-data");if(!e||!e.textContent)return console.warn("[App] Tunnel de data #zflex-data est vide ou introuvable."),{};try{return JSON.parse(e.textContent)}catch(t){return console.error("[App] Erreur de parsing du tunnel de data #zflex-data:",t),{}}}const Ae={"product-detail":async()=>{const{initProductGallery:e}=await z(async()=>{const{initProductGallery:t}=await import("../assets/product-gallery-CW4kno63.js");return{initProductGallery:t}},[]);return at(),e(),{destroy:()=>console.log("[App] Cleanup: product-detail")}},"category-view":async()=>{const{initFilterSort:e}=await z(async()=>{const{initFilterSort:t}=await Promise.resolve().then(()=>Ye);return{initFilterSort:t}},void 0);return e(),{destroy:()=>console.log("[App] Cleanup: category-view")}},cart:async()=>(ot(),{destroy:()=>console.log("[App] Cleanup: cart")}),checkout:async()=>{const{initCheckout:e}=await z(async()=>{const{initCheckout:t}=await import("../assets/checkout-D8mBWSwY.js");return{initCheckout:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: checkout")}},"order-success":async()=>{const{initOrderSuccess:e}=await z(async()=>{const{initOrderSuccess:t}=await import("../assets/order-success-DaRlGU8P.js");return{initOrderSuccess:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: order-success")}},verify:async()=>{const{initVerifyPage:e}=await z(async()=>{const{initVerifyPage:t}=await import("../assets/verify-Bve0uL8W.js");return{initVerifyPage:t}},[]);return e(),{destroy:()=>console.log("[App] Cleanup: verify")}},"not-found":async()=>({destroy:()=>console.log("[App] Cleanup: not-found")}),unknown:async()=>({destroy:()=>{}})};async function ze(){var r;V&&typeof V.destroy=="function"&&V.destroy();const e=document.querySelector("#app-content main"),t=((r=e==null?void 0:e.dataset)==null?void 0:r.pageType)||"unknown";console.log(`[App] Chargement des scripts pour la page: "${t}"`);const n=Ae[t]||Ae.unknown;try{V=await n()}catch(o){console.error(`[App] Erreur lors du chargement du module pour "${t}":`,o),V=null}jt()}function Gt(){console.log("[Preview] Initialisation du mode éditeur temps réel");function e(a){if(!a)return{r:0,g:0,b:0};const u=a.replace("#","").trim(),c=u.length===3?u.split("").map(f=>f+f).join(""):u;return{r:parseInt(c.substring(0,2),16),g:parseInt(c.substring(2,4),16),b:parseInt(c.substring(4,6),16)}}function t(a,u,c){return"#"+[a,u,c].map(f=>Math.max(0,Math.min(255,Math.round(f))).toString(16).padStart(2,"0")).join("")}function n(a,u,c){const f=e(a||"#000000"),d=e(u||"#ffffff"),p=Math.round(f.r*(1-c)+d.r*c),y=Math.round(f.g*(1-c)+d.g*c),g=Math.round(f.b*(1-c)+d.b*c);return t(p,y,g)}function r(a,u){const{r:c,g:f,b:d}=e(a||"#000000");let p=c/255,y=f/255,g=d/255;const h=Math.max(p,y,g),v=Math.min(p,y,g);let w=0,b=0,C=(h+v)/2;if(h!==v){const S=h-v;switch(b=C>.5?S/(2-h-v):S/(h+v),h){case p:w=(y-g)/S+(y<g?6:0);break;case y:w=(g-p)/S+2;break;default:w=(p-y)/S+4;break}w/=6}if(C=Math.max(0,Math.min(1,C+u/100)),b===0){const S=Math.round(C*255);return t(S,S,S)}const O=C<.5?C*(1+b):C+b-C*b,F=2*C-O,E=(S,se,Ue)=>{let k=Ue;return k<0&&(k+=1),k>1&&(k-=1),k<1/6?S+(se-S)*6*k:k<1/2?se:k<2/3?S+(se-S)*(2/3-k)*6:S},Ve=Math.round(E(F,O,w+1/3)*255),je=Math.round(E(F,O,w)*255),Je=Math.round(E(F,O,w-1/3)*255);return t(Ve,je,Je)}const o={"--card-background-color":"--card-bg-color","--card-bg-color":"--card-bg-color","--card-border-color":"--card-border-color","--card-border":"--card-border-color","--text-muted-color":"--text-muted-color","--muted-text-color":"--text-muted-color","--input-bg-color":"--input-bg-color","--input-background-color":"--input-bg-color","--chat-response-bg-color":"--chat-response-bg-color","--chat-response-background":"--chat-response-bg-color","--bg-color":"--bg-color","--background-color":"--bg-color","--primary-color":"--primary-color","--accent-color":"--accent-color","--secondary-color":"--secondary-color","--primary-600":"--primary-600","--primary-700":"--primary-700","--secondary-600":"--secondary-600"};function i(a){if(!a)return a;const u=a.trim();return o[u]||u}function s(a){var y,g,h,v;const u=ae(),c=((g=(y=u==null?void 0:u.theme)==null?void 0:y.settings)==null?void 0:g.palette)||{},f=((v=(h=u==null?void 0:u.theme)==null?void 0:h.settings)==null?void 0:v.computedPalette)||{},d=a.replace(/^--/,""),p=[d,d.replace(/-bg-?/,"-background"),d.replace(/-background-?/,"-bg")];for(const w of p){if(typeof c[w]=="string"&&c[w].trim()!=="")return c[w];if(typeof f[w]=="string"&&f[w].trim()!=="")return f[w]}return typeof c[a]=="string"&&c[a].trim()!==""?c[a]:typeof f[a]=="string"&&f[a].trim()!==""?f[a]:null}function l(){const a={background:"#ffffff",text:"#111827",primary:"#000000",secondary:"#6B7280",accent:"#3B82F6",cardBackground:"#ffffff"},u=getComputedStyle(document.documentElement),c=s("background")||u.getPropertyValue("--bg-color").trim()||u.getPropertyValue("--background-color").trim()||a.background,f=s("text")||u.getPropertyValue("--text-color").trim()||a.text,d=s("primary")||u.getPropertyValue("--primary-color").trim()||a.primary,p=s("secondary")||u.getPropertyValue("--secondary-color").trim()||a.secondary,y=s("accent")||u.getPropertyValue("--accent-color").trim()||a.accent,g=s("cardBackground")||u.getPropertyValue("--card-bg-color").trim()||u.getPropertyValue("--card-background-color").trim()||a.cardBackground,h=n(f,c,.6),v=n(g,f,.12),w=r(g,3),b=r(c,2),C=r(d,-8),O=r(d,-14),F=r(p,-6),E=document.documentElement;E.style.setProperty("--bg-color",c),E.style.setProperty("--text-color",f),E.style.setProperty("--primary-color",d),E.style.setProperty("--secondary-color",p),E.style.setProperty("--accent-color",y),E.style.setProperty("--card-bg-color",g),E.style.setProperty("--text-muted-color",h),E.style.setProperty("--card-border-color",v),E.style.setProperty("--input-bg-color",w),E.style.setProperty("--chat-response-bg-color",b),E.style.setProperty("--primary-600",C),E.style.setProperty("--primary-700",O),E.style.setProperty("--secondary-600",F)}function m(a,u){if(!a||a===u)return;const c=`var(${a})`;document.querySelectorAll("[style]").forEach(d=>{const p=d.getAttribute("style")||"";p.includes(c)&&d.setAttribute("style",p.split(c).join(`var(${u})`))})}try{l()}catch(a){console.warn("[Preview] recompute initial failed",a)}window.addEventListener("message",a=>{if(!(a!=null&&a.data)||a.data.source!=="zflex-admin")return;const{action:u,payload:c}=a.data;if(console.log("[Preview] Message reçu de l'éditeur:",a.data),u==="updateElement"){const{id:f,value:d}=c||{},p=document.querySelector(`[data-zflex-id="${f}"]`);if(!p)return;p.tagName==="IMG"?(p.src=d,p.alt=d||p.alt||""):p.innerText=d,p.style.transition="all 0.25s ease",p.style.transform="scale(1.02)",setTimeout(()=>{p.style.transform=""},220);return}if(u==="updateStyle"){const{property:f,value:d}=c||{};if(!f)return;const p=f.trim(),y=i(p);console.log(`[Preview] Mise à jour style (incoming: ${p}) -> canonical: ${y}:`,d);try{document.documentElement.style.setProperty(p,d)}catch{}try{document.documentElement.style.setProperty(y,d)}catch{}try{m(p,y)}catch{}const g=new Set(["--bg-color","--background-color","--primary-color","--accent-color","--text-color","--card-bg-color","--card-background-color"]);if(g.has(y)||g.has(p))try{l()}catch(h){console.warn("[Preview] recompute after updateStyle failed:",h)}(p.includes("color")||y.includes("color"))&&(document.body.style.transition="background-color 0.22s ease, color 0.22s ease",setTimeout(()=>{document.body.style.transition=""},300));try{document.documentElement.offsetHeight,window.dispatchEvent(new CustomEvent("zflex:theme-updated",{detail:{property:y,value:d,time:Date.now()}}))}catch(h){console.warn("[Preview] notify theme update failed",h)}}}),window.parent!==window&&window.parent.postMessage({source:"zflex-preview",action:"ready",payload:{url:window.location.href}},"*")}function _e(){if(Pe)return;console.log("[App] Démarrage zFlex — L'Architecture Finale.");const e=new URLSearchParams(window.location.search).get("preview")==="true";e?(console.log("[App] Mode Preview activé - Désactivation des interactions utilisateur"),document.body.style.pointerEvents="none",document.body.style.cursor="not-allowed",Gt()):console.log("[App] Mode normal - Initialisation des scripts interactifs");try{if(!window.firebase||!window.firebase.initializeApp)throw new Error("Le SDK Firebase (compat) n'a pas été chargé. Vérifie les scripts dans _head.njk.");const n=document.getElementById("firebase-config-data");if(!n)throw new Error("Firebase config data island not found.");const r=JSON.parse(n.textContent||"{}");if(!r.apiKey)throw new Error("Firebase apiKey is missing.");window.firebase.initializeApp(r),console.log("[Firebase] Initialisation via le scope global réussie.")}catch(n){console.error("[Firebase] ÉCHEC CRITIQUE DE L'INITIALISATION :",n);return}e||(st(),Ct(Te),Pt(),It(),et(),Rt(),Ft(),Te.init()),ze(),Pe=!0;const t=["color: #00BFFF","font-size: 12px","font-family: monospace","background: #0E0E0E","padding: 4px 8px","border-radius: 4px"].join(";");console.log("%c Fearless Engine: Online. Status: Flawless. ",t),window.location.hostname==="localhost"||window.location.hostname.includes("192.168.")?(console.log("------------------"),console.log("< Happy Hacking! — Fearless >"),console.log("------------------"),console.log("        \\   ^__^"),console.log("         \\  (oo)\\_______"),console.log("            (__)\\       )/\\"),console.log("                ||----w |"),console.log("                ||     ||"),console.log(`
version: dev (local)`)):(console.log("------------------"),console.log("< Ready for Action! — Fearless >"),console.log("------------------"),console.log("        \\   ^__^"),console.log("         \\  (oo)\\_______"),console.log("            (__)\\       )/\\"),console.log("                ||----w |"),console.log("                ||     ||"),console.log(`
version: production (${new Date().toISOString().slice(0,10)})`))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",_e,{once:!0}):_e();export{z as _,Zt as a,Xt as b,Kt as c,Wt as d,U as e,Qt as f,H as g,Yt as i,Te as r,M as s};
