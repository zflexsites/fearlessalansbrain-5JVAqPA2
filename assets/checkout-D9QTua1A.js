import{g as T,a as B,e as M}from"../js/app.js";function O(n){const i=document.getElementById("summary-items-list"),a=document.getElementById("summary-subtotal"),d=document.getElementById("summary-total");if(!i||!a||!d)return;if(!n||n.length===0){i.innerHTML='<p class="text-sm text-center">Votre panier est vide.</p>';return}i.innerHTML="";const l={};n.forEach(t=>{const s=document.createElement("div");s.className="flex justify-between text-sm",s.innerHTML=`<div><span class="font-semibold">${t.quantity} x</span> ${t.title}</div><span>${(t.price.amount*t.quantity).toFixed(2)} ${t.price.currency}</span>`,i.appendChild(s);const c=t.price.currency;l[c]||(l[c]=0),l[c]+=t.price.amount*t.quantity}),a.innerHTML="",d.innerHTML="",Object.entries(l).forEach(([t,s])=>{const c=`${Number(s).toFixed(2)} ${t}`;a.innerHTML+=`<div>${c}</div>`,d.innerHTML+=`<div>${c}</div>`})}function A(){var h;const n=document.getElementById("checkout-form");if(!n)return;let i=null;const a=document.getElementById("checkout-error"),d=async()=>{const o=localStorage.getItem("zflex_prospectId");if(o)try{const e=await B(i,o);e.success&&e.data&&M.dispatchEvent(new CustomEvent("dialog:show",{detail:{title:"On vous reconnaît !",message:"Voulez-vous utiliser les informations de votre dernière visite ?",confirmText:"Oui, utiliser",cancelText:"Non, merci",onConfirm:()=>{n.elements.name.value=e.data.name||"",n.elements.phone.value=e.data.phone||"",n.elements.address.value=e.data.address||""}}}))}catch(e){console.warn("Impossible de récupérer les infos du prospect/client:",e),localStorage.removeItem("zflex_prospectId")}};try{const o=JSON.parse(((h=document.querySelector(".zflex-fragment-data"))==null?void 0:h.textContent)||"{}");if(!o.storeId)throw new Error("ID du store non trouvé.");i=o.storeId,d()}catch(o){console.error("[Checkout] Erreur critique à l'initialisation:",o.message);const e=document.querySelector(".lg\\:col-span-3");e&&(e.innerHTML='<div class="text-red-500 p-4 border border-red-200 rounded-lg bg-red-50"><strong>Erreur de chargement.</strong> Impossible de récupérer les informations de la boutique. Veuillez rafraîchir la page.</div>');return}const l=T()||[];O(l);const t=document.getElementById("continue-to-payment-btn");document.getElementById("progress-bar"),document.getElementById("submit-order-btn");const s=document.getElementById("payment-phone"),c=document.getElementById("operator-logo-container"),m=document.getElementById("selected-payment-method"),p=document.getElementById("payment-instructions"),g=document.getElementById("use-geolocation-btn"),E=()=>{const e=s.value.replace(/\s/g,"").substring(0,2);let r=null;const I=["81","82","83"],L=["80","84","85","89"],b=["97","99"],C=["90"];if(I.includes(e)&&(r="MPESA"),L.includes(e)&&(r="ORANGE"),b.includes(e)&&(r="AIRTEL"),C.includes(e)&&(r="AFRICELL"),c.innerHTML="",r){const u=document.createElement("img"),x=r==="ORANGE"?"orangemoney":r==="AIRTEL"?"airtelmoney":r.toLowerCase();u.src=`/img/${x}.png`,u.className="h-6",c.appendChild(u),m.value=r,p.innerHTML=`<p>Opérateur <strong>${r}</strong> détecté. Vous recevrez une notification pour valider.</p>`}else m.value="",p.innerHTML="<p>Veuillez entrer un numéro valide pour détecter l'opérateur.</p>"},v=()=>{},y=async()=>{},f=async o=>{o.preventDefault(),a.classList.add("hidden");{a.textContent="Erreur critique : ID de commande manquant. Veuillez rafraîchir.",a.classList.remove("hidden");return}};return t.addEventListener("click",y),s.addEventListener("input",E),g.addEventListener("click",v),n.addEventListener("submit",f),console.log("[Checkout] Module V9.0 (L'Omniscient) initialisé."),{destroy:()=>{t.removeEventListener("click",y),s.removeEventListener("input",E),g.removeEventListener("click",v),n.removeEventListener("submit",f),console.log("[Checkout] Module détruit.")}}}export{A as initCheckout};
